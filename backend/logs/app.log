[2025-10-23 16:34:21] INFO [model_manager] 加载模型配置成功！
[2025-10-23 16:34:21] INFO [model_manager] Get model config for model 'openai'
[2026-01-14 23:46:08] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:46:08] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:46:08] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:46:08] INFO [app] 正在注册中间件
[2026-01-14 23:46:08] INFO [app] 注册中间件成功
[2026-01-14 23:46:08] INFO [app] 正在启动fastapi应用
[2026-01-14 23:46:08] INFO [app] 正在注册数据库
[2026-01-14 23:46:08] INFO [prosgresql_config] 初始化异步数据库配置
[2026-01-14 23:46:08] INFO [prosgresql_config] PostgreSQL异步引擎创建成功
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [generated in 0.00072s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.006157s ago] ('patients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.008198s ago] ('user_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.009949s ago] ('user_states', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.01175s ago] ('user_activities', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.01408s ago] ('refresh_tokens', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.01608s ago] ('conversations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.01778s ago] ('messages', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.01958s ago] ('medical_cases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.0214s ago] ('symptoms', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.02298s ago] ('syndromes', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.02462s ago] ('medical_records', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.0262s ago] ('tongue_analysis', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.02821s ago] ('prescription_recommendations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.02995s ago] ('herbs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.03155s ago] ('herb_inventory', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.03381s ago] ('prescriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.03605s ago] ('classic_texts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.03782s ago] ('system_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.03949s ago] ('model_providers', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.04169s ago] ('model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [cached since 0.04348s ago] ('user_model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] [generated in 0.00076s] ('devicetype', 'pg_catalog')
[2026-01-14 23:46:08] INFO [prosgresql_config] 数据库表创建/检查完成
[2026-01-14 23:46:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-14 23:46:08] INFO [prosgresql_config] 异步会话工厂创建成功
[2026-01-14 23:46:08] INFO [app] 注册数据库完成
[2026-01-14 23:46:08] INFO [app] 正在注册路由
[2026-01-14 23:46:08] INFO [app] 注册路由完成
[2026-01-14 23:46:30] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-14 23:46:30] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:46:30] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-14 23:46:30] INFO [sqlalchemy.engine.Engine] [generated in 0.00065s] ('pyan83426@163.com',)
[2026-01-14 23:46:36] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:46:42] INFO [sqlalchemy.engine.Engine] [generated in 5.11101s] (UUID('af182da7-60cf-42b9-9397-bda95e5c05e3'), '彭彦林', 'pyan83426@163.com', '$2b$12$LaQhDQLFDy3WMgw6waRcY.l2GdgZ4D2RbzlqJJWEuZ1W1FnChVTai', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 14, 23, 46, 30, 980130), datetime.datetime(2026, 1, 14, 23, 46, 30, 980569))
[2026-01-14 23:46:47] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-14 23:46:50] INFO [sqlalchemy.engine.Engine] [generated in 3.18566s] (UUID('af182da7-60cf-42b9-9397-bda95e5c05e3'),)
[2026-01-14 23:47:03] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:47:05] INFO [sqlalchemy.engine.Engine] [generated in 2.29225s] (UUID('0c3b7767-4ae4-4f41-81b9-fbeac58aaca2'), UUID('af182da7-60cf-42b9-9397-bda95e5c05e3'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 14, 23, 46, 59, 10290))
[2026-01-14 23:47:08] INFO [UserService] 用户活动已记录: register, user_id=af182da7-60cf-42b9-9397-bda95e5c05e3
[2026-01-14 23:47:11] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-14 23:47:15] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-14 23:47:43] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-14 23:47:48] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001F1BDE8FC40>>
[2026-01-14 23:47:53] ERROR [asyncio] Task exception was never retrieved
future: <Task finished name='Task-17' coro=<AsyncAdapt_asyncpg_connection._terminate_graceful_close() done, defined at D:\code\SmartTCM-Agent-SYSTEM\backend\.renyi\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py:910> exception=TimeoutError()>
[2026-01-14 23:48:10] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001F1BDE8FC40>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-14 23:49:42] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:49:42] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:49:42] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:49:42] INFO [app] 正在注册中间件
[2026-01-14 23:49:42] INFO [app] 注册中间件成功
[2026-01-14 23:49:42] INFO [app] 正在启动fastapi应用
[2026-01-14 23:49:42] INFO [app] 正在注册数据库
[2026-01-14 23:49:42] INFO [prosgresql_config] 初始化异步数据库配置
[2026-01-14 23:49:42] INFO [prosgresql_config] PostgreSQL异步引擎创建成功
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00069s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.00559s ago] ('patients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.007646s ago] ('user_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.009324s ago] ('user_states', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.01116s ago] ('user_activities', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.01337s ago] ('refresh_tokens', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.01529s ago] ('conversations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.0168s ago] ('messages', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.01821s ago] ('medical_cases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.01978s ago] ('symptoms', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02156s ago] ('syndromes', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02308s ago] ('medical_records', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02453s ago] ('tongue_analysis', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02631s ago] ('prescription_recommendations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02811s ago] ('herbs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.02966s ago] ('herb_inventory', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.03109s ago] ('prescriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.03256s ago] ('classic_texts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.03422s ago] ('system_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.03596s ago] ('model_providers', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.03761s ago] ('model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [cached since 0.0393s ago] ('user_model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00048s] ('devicetype', 'pg_catalog')
[2026-01-14 23:49:42] INFO [prosgresql_config] 数据库表创建/检查完成
[2026-01-14 23:49:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-14 23:49:42] INFO [prosgresql_config] 异步会话工厂创建成功
[2026-01-14 23:49:42] INFO [app] 注册数据库完成
[2026-01-14 23:49:42] INFO [app] 正在注册路由
[2026-01-14 23:49:51] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:49:51] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:49:51] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:49:51] INFO [app] 正在注册中间件
[2026-01-14 23:49:51] INFO [app] 注册中间件成功
[2026-01-14 23:49:51] INFO [app] 正在启动fastapi应用
[2026-01-14 23:49:51] INFO [app] 正在注册数据库
[2026-01-14 23:49:51] INFO [prosgresql_config] 初始化异步数据库配置
[2026-01-14 23:49:51] INFO [prosgresql_config] PostgreSQL异步引擎创建成功
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [generated in 0.00032s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.004779s ago] ('patients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.006335s ago] ('user_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.007441s ago] ('user_states', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.008464s ago] ('user_activities', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.009478s ago] ('refresh_tokens', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01055s ago] ('conversations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01164s ago] ('messages', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01271s ago] ('medical_cases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01352s ago] ('symptoms', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01415s ago] ('syndromes', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01494s ago] ('medical_records', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01548s ago] ('tongue_analysis', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01601s ago] ('prescription_recommendations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01655s ago] ('herbs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01707s ago] ('herb_inventory', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01761s ago] ('prescriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01841s ago] ('classic_texts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.01931s ago] ('system_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.02007s ago] ('model_providers', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.02092s ago] ('model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [cached since 0.02167s ago] ('user_model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] [generated in 0.00023s] ('devicetype', 'pg_catalog')
[2026-01-14 23:49:51] INFO [prosgresql_config] 数据库表创建/检查完成
[2026-01-14 23:49:51] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-14 23:49:51] INFO [prosgresql_config] 异步会话工厂创建成功
[2026-01-14 23:49:51] INFO [app] 注册数据库完成
[2026-01-14 23:49:51] INFO [app] 正在注册路由
[2026-01-14 23:49:51] INFO [app] 注册路由完成
[2026-01-14 23:50:20] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-14 23:50:20] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:50:20] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-14 23:50:20] INFO [sqlalchemy.engine.Engine] [generated in 0.00029s] ('pyan83426@163.com',)
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] [generated in 0.00042s] (UUID('385becd8-c990-46fe-a8d5-1555bce00f01'), '彭彦林', 'pyan83426@163.com', '$2b$12$aOeZd9XH/stQYtIG7sROY.kwlKIDtANINJl4nXRXin9XWlLGeDgZ6', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 14, 23, 50, 21, 125496), datetime.datetime(2026, 1, 14, 23, 50, 21, 125496))
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('385becd8-c990-46fe-a8d5-1555bce00f01'),)
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] [generated in 0.00043s] (UUID('d8a366b4-e845-40ba-8c0d-66bb454ca511'), UUID('385becd8-c990-46fe-a8d5-1555bce00f01'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 14, 23, 50, 21, 132938))
[2026-01-14 23:50:21] INFO [UserService] 用户活动已记录: register, user_id=385becd8-c990-46fe-a8d5-1555bce00f01
[2026-01-14 23:50:21] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-14 23:50:21] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-14 23:50:21] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-14 23:50:21] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000025EA44CCC70>>
[2026-01-14 23:53:44] ERROR [app] fastapi应用关闭
[2026-01-14 23:53:44] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000025EA44CCC70>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-14 23:53:53] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:53:53] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:53:53] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:53:53] INFO [app] 正在注册中间件
[2026-01-14 23:53:53] INFO [app] 注册中间件成功
[2026-01-14 23:53:53] INFO [app] 正在启动fastapi应用
[2026-01-14 23:53:53] INFO [app] 正在注册数据库
[2026-01-14 23:53:53] INFO [prosgresql_config] 初始化异步数据库配置
[2026-01-14 23:53:53] INFO [prosgresql_config] PostgreSQL异步引擎创建成功
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.005741s ago] ('patients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.00743s ago] ('user_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.008993s ago] ('user_states', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0103s ago] ('user_activities', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01236s ago] ('refresh_tokens', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01375s ago] ('conversations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01451s ago] ('messages', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01546s ago] ('medical_cases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01688s ago] ('symptoms', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01804s ago] ('syndromes', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01932s ago] ('medical_records', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02033s ago] ('tongue_analysis', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02116s ago] ('prescription_recommendations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02204s ago] ('herbs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02331s ago] ('herb_inventory', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02441s ago] ('prescriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02534s ago] ('classic_texts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02618s ago] ('system_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0269s ago] ('model_providers', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02759s ago] ('model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02843s ago] ('user_model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] ('devicetype', 'pg_catalog')
[2026-01-14 23:53:53] INFO [prosgresql_config] 数据库表创建/检查完成
[2026-01-14 23:53:53] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-14 23:53:53] INFO [prosgresql_config] 异步会话工厂创建成功
[2026-01-14 23:53:53] INFO [app] 注册数据库完成
[2026-01-14 23:53:53] INFO [app] 正在注册路由
[2026-01-14 23:53:53] INFO [app] 注册路由完成
[2026-01-14 23:53:59] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] [generated in 0.00029s] ('pyan83426@163.com',)
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('f21978ba-5d95-4631-9a85-f2fda4bfc21c'), '彭彦林', 'pyan83426@163.com', '$2b$12$b5Vc7d5VFGPm4ICHx9D4nOBc97upPOHrrprRq5TwgtilB0pbxN7fC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 14, 23, 53, 59, 770800), datetime.datetime(2026, 1, 14, 23, 53, 59, 771227))
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] [generated in 0.00024s] (UUID('f21978ba-5d95-4631-9a85-f2fda4bfc21c'),)
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] [generated in 0.00032s] (UUID('f64b6bec-2eac-4522-9ca9-22156de74734'), UUID('f21978ba-5d95-4631-9a85-f2fda4bfc21c'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 14, 23, 53, 59, 778879))
[2026-01-14 23:53:59] INFO [UserService] 用户活动已记录: register, user_id=f21978ba-5d95-4631-9a85-f2fda4bfc21c
[2026-01-14 23:53:59] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-14 23:53:59] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-14 23:53:59] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-14 23:53:59] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x00000213E3E60D60>>
[2026-01-14 23:54:45] ERROR [app] fastapi应用关闭
[2026-01-14 23:54:45] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x00000213E3E60D60>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-14 23:56:41] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:56:41] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:56:41] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:56:41] INFO [app] 正在注册中间件
[2026-01-14 23:56:41] INFO [app] 注册中间件成功
[2026-01-14 23:56:41] INFO [app] 正在启动fastapi应用
[2026-01-14 23:56:41] INFO [app] 正在注册数据库
[2026-01-14 23:56:41] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-14 23:56:41] ERROR [app] fastapi应用关闭
[2026-01-14 23:58:46] INFO [app] 创建 FastAPI 应用实例
[2026-01-14 23:58:46] INFO [app] 正在注册全局异常管理器
[2026-01-14 23:58:46] INFO [app] 注册全局异常管理器成功
[2026-01-14 23:58:46] INFO [app] 正在注册中间件
[2026-01-14 23:58:46] INFO [app] 注册中间件成功
[2026-01-14 23:58:46] INFO [app] 正在启动fastapi应用
[2026-01-14 23:58:46] INFO [app] 正在注册数据库
[2026-01-14 23:58:46] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-14 23:58:46] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-14 23:58:46] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-14 23:58:46] INFO [app] 注册数据库完成
[2026-01-14 23:58:46] INFO [app] 正在注册路由
[2026-01-14 23:58:46] INFO [app] 注册路由完成
[2026-01-14 23:58:52] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00049s] (UUID('30f02b73-cfe1-4ee4-8fe9-eaf5ec49c207'), '彭彦林', 'pyan83426@163.com', '$2b$12$yZMaZFTb4sShj.sK.crO0eVAgtCT5MX9fpxEFZZ0h6WGiq3ueI9kO', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 14, 23, 58, 53, 524711), datetime.datetime(2026, 1, 14, 23, 58, 53, 524711))
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00027s] (UUID('30f02b73-cfe1-4ee4-8fe9-eaf5ec49c207'),)
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00037s] (UUID('f3486313-971f-48bf-842d-4ae33fe21bd8'), UUID('30f02b73-cfe1-4ee4-8fe9-eaf5ec49c207'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 14, 23, 58, 53, 535030))
[2026-01-14 23:58:53] INFO [UserService] 用户活动已记录: register, user_id=30f02b73-cfe1-4ee4-8fe9-eaf5ec49c207
[2026-01-14 23:58:53] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-14 23:58:53] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-14 23:58:53] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-14 23:58:53] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002818E746020>>
[2026-01-15 00:00:44] ERROR [app] fastapi应用关闭
[2026-01-15 00:00:44] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002818E746020>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 00:00:52] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 00:00:52] INFO [app] 正在注册全局异常管理器
[2026-01-15 00:00:52] INFO [app] 注册全局异常管理器成功
[2026-01-15 00:00:52] INFO [app] 正在注册中间件
[2026-01-15 00:00:52] INFO [app] 注册中间件成功
[2026-01-15 00:00:52] INFO [app] 正在启动fastapi应用
[2026-01-15 00:00:52] INFO [app] 正在注册数据库
[2026-01-15 00:00:52] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 00:00:53] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 00:00:53] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 00:00:53] INFO [app] 注册数据库完成
[2026-01-15 00:00:53] INFO [app] 正在注册路由
[2026-01-15 00:00:53] INFO [app] 注册路由完成
[2026-01-15 00:00:56] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [generated in 0.00046s] ('pyan83426@163.com',)
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [generated in 0.01582s] (UUID('04c0b5e9-ec1b-4fe9-bc1a-c69748a6a69e'), '彭彦林', 'pyan83426@163.com', '$2b$12$eEIFbhcsMvc6bUHKaz.GoOfmH8QyTQWfZz3ga1Kv0Gu9kr6Brdbre', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 0, 0, 56, 740779), datetime.datetime(2026, 1, 15, 0, 0, 56, 740779))
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [generated in 0.00043s] (UUID('04c0b5e9-ec1b-4fe9-bc1a-c69748a6a69e'),)
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] [generated in 0.00053s] (UUID('3f8fb834-e981-43bc-afee-c33cb11af24e'), UUID('04c0b5e9-ec1b-4fe9-bc1a-c69748a6a69e'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 0, 0, 56, 768917))
[2026-01-15 00:00:56] INFO [UserService] 用户活动已记录: register, user_id=04c0b5e9-ec1b-4fe9-bc1a-c69748a6a69e
[2026-01-15 00:00:56] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 00:00:56] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 00:00:56] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 00:00:56] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000014F387C6F20>>
[2026-01-15 00:05:45] ERROR [app] fastapi应用关闭
[2026-01-15 00:05:45] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000014F387C6F20>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 00:05:55] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 00:05:55] INFO [app] 正在注册全局异常管理器
[2026-01-15 00:05:55] INFO [app] 注册全局异常管理器成功
[2026-01-15 00:05:55] INFO [app] 正在注册中间件
[2026-01-15 00:05:55] INFO [app] 注册中间件成功
[2026-01-15 00:05:55] INFO [app] 正在启动fastapi应用
[2026-01-15 00:05:55] INFO [app] 正在注册数据库
[2026-01-15 00:05:55] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 00:05:55] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 00:05:55] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 00:05:55] INFO [app] 注册数据库完成
[2026-01-15 00:05:55] INFO [app] 正在注册路由
[2026-01-15 00:05:55] INFO [app] 注册路由完成
[2026-01-15 00:05:57] ERROR [app] fastapi应用关闭
[2026-01-15 00:06:06] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 00:06:06] INFO [app] 正在注册全局异常管理器
[2026-01-15 00:06:06] INFO [app] 注册全局异常管理器成功
[2026-01-15 00:06:06] INFO [app] 正在注册中间件
[2026-01-15 00:06:06] INFO [app] 注册中间件成功
[2026-01-15 00:06:06] INFO [app] 正在启动fastapi应用
[2026-01-15 00:06:06] INFO [app] 正在注册数据库
[2026-01-15 00:06:06] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 00:06:06] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 00:06:06] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 00:06:06] INFO [app] 注册数据库完成
[2026-01-15 00:06:06] INFO [app] 正在注册路由
[2026-01-15 00:06:06] INFO [app] 注册路由完成
[2026-01-15 00:06:17] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00054s] ('pyan83426@163.com',)
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('7bc37d09-6bd4-4c9b-b3ea-457015b218eb'), '彭彦林', 'pyan83426@163.com', '$2b$12$HzfCmd.DDkOaULgNhyZgwOJ./FCdPGZ/wmxCzdxkWLAn7TDEpavDy', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 0, 6, 17, 822916), datetime.datetime(2026, 1, 15, 0, 6, 17, 822916))
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('7bc37d09-6bd4-4c9b-b3ea-457015b218eb'),)
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('7a623fba-ab34-4185-abcd-1a1c7a405d83'), UUID('7bc37d09-6bd4-4c9b-b3ea-457015b218eb'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 0, 6, 17, 831984))
[2026-01-15 00:06:17] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 00:06:17] INFO [UserService] 用户活动已记录: register, user_id=7bc37d09-6bd4-4c9b-b3ea-457015b218eb
[2026-01-15 00:06:17] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 00:06:17] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 00:07:34] ERROR [app] fastapi应用关闭
[2026-01-15 09:43:39] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 09:43:39] INFO [app] 正在注册全局异常管理器
[2026-01-15 09:43:39] INFO [app] 注册全局异常管理器成功
[2026-01-15 09:43:39] INFO [app] 正在注册中间件
[2026-01-15 09:43:39] INFO [app] 注册中间件成功
[2026-01-15 09:43:39] INFO [app] 正在启动fastapi应用
[2026-01-15 09:43:39] INFO [app] 正在注册数据库
[2026-01-15 09:43:39] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 09:43:40] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 09:43:40] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 09:43:40] INFO [app] 注册数据库完成
[2026-01-15 09:43:40] INFO [app] 正在注册路由
[2026-01-15 09:43:40] INFO [app] 注册路由完成
[2026-01-15 09:45:38] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:45:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] [generated in 0.00060s] ('pyan83426@163.com',)
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] [generated in 0.00075s] (UUID('ddfde88b-8bd4-4b6e-94f6-7c43abad87dd'), '彭彦林', 'pyan83426@163.com', '$2b$12$RsD55s0w1D24L.WaWuwgwem/4hQ23fzx/p2onttJqUQEL5wtBgKqW', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 9, 45, 39, 461117), datetime.datetime(2026, 1, 15, 9, 45, 39, 461117))
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 09:45:39] INFO [sqlalchemy.engine.Engine] [generated in 0.00054s] (UUID('ddfde88b-8bd4-4b6e-94f6-7c43abad87dd'),)
[2026-01-15 09:45:44] INFO [sqlalchemy.engine.Engine] SELECT conversations.id AS conversations_id, conversations.user_id AS conversations_user_id, conversations.session_id AS conversations_session_id, conversations.conversation_type AS conversations_conversation_type, conversations.title AS conversations_title, conversations.status AS conversations_status, conversations.total_messages AS conversations_total_messages, conversations.created_at AS conversations_created_at, conversations.updated_at AS conversations_updated_at 
FROM conversations 
WHERE $1::UUID = conversations.user_id
[2026-01-15 09:45:44] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('ddfde88b-8bd4-4b6e-94f6-7c43abad87dd'),)
[2026-01-15 09:45:44] INFO [sqlalchemy.engine.Engine] SELECT patients.id AS patients_id, patients.user_id AS patients_user_id, patients.patient_code AS patients_patient_code, patients.medical_history AS patients_medical_history, patients.family_history AS patients_family_history, patients.allergy_info AS patients_allergy_info, patients.current_medications AS patients_current_medications, patients.emergency_contact_name AS patients_emergency_contact_name, patients.emergency_contact_phone AS patients_emergency_contact_phone, patients.created_at AS patients_created_at, patients.updated_at AS patients_updated_at 
FROM patients 
WHERE $1::UUID = patients.user_id
[2026-01-15 09:45:44] INFO [sqlalchemy.engine.Engine] [generated in 0.00032s] (UUID('ddfde88b-8bd4-4b6e-94f6-7c43abad87dd'),)
[2026-01-15 09:46:02] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 09:46:05] INFO [sqlalchemy.engine.Engine] [generated in 2.73441s] (UUID('f1cbb9bb-996f-4c7a-a8ef-62f5bc371478'), UUID('ddfde88b-8bd4-4b6e-94f6-7c43abad87dd'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 9, 45, 59, 662255))
[2026-01-15 09:46:11] INFO [UserService] 用户活动已记录: register, user_id=ddfde88b-8bd4-4b6e-94f6-7c43abad87dd
[2026-01-15 09:46:17] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 09:46:22] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 09:46:49] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 09:46:51] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000024D1039F010>>
[2026-01-15 09:48:48] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 09:48:48] INFO [app] 正在注册全局异常管理器
[2026-01-15 09:48:48] INFO [app] 注册全局异常管理器成功
[2026-01-15 09:48:48] INFO [app] 正在注册中间件
[2026-01-15 09:48:48] INFO [app] 注册中间件成功
[2026-01-15 09:48:48] INFO [app] 正在启动fastapi应用
[2026-01-15 09:48:48] INFO [app] 正在注册数据库
[2026-01-15 09:48:48] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 09:48:48] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 09:48:48] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 09:48:48] INFO [app] 注册数据库完成
[2026-01-15 09:48:48] INFO [app] 正在注册路由
[2026-01-15 09:48:48] INFO [app] 注册路由完成
[2026-01-15 09:48:48] ERROR [app] fastapi应用关闭
[2026-01-15 09:48:57] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 09:48:57] INFO [app] 正在注册全局异常管理器
[2026-01-15 09:48:57] INFO [app] 注册全局异常管理器成功
[2026-01-15 09:48:57] INFO [app] 正在注册中间件
[2026-01-15 09:48:57] INFO [app] 注册中间件成功
[2026-01-15 09:48:57] INFO [app] 正在启动fastapi应用
[2026-01-15 09:48:57] INFO [app] 正在注册数据库
[2026-01-15 09:48:57] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 09:48:57] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 09:48:57] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 09:48:57] INFO [app] 注册数据库完成
[2026-01-15 09:48:57] INFO [app] 正在注册路由
[2026-01-15 09:48:57] INFO [app] 注册路由完成
[2026-01-15 09:49:00] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 09:49:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('a9d5fdfc-8960-487c-a534-81bc2c24caf9'), '彭彦林', 'pyan83426@163.com', '$2b$12$jof/VfpjSCeqDiBrdqIkU.ymfv.OmnDBV2.h5NGaeJ8OsE2ABSdzm', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 9, 49, 1, 172550), datetime.datetime(2026, 1, 15, 9, 49, 1, 172550))
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('a9d5fdfc-8960-487c-a534-81bc2c24caf9'),)
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00037s] (UUID('c80c909a-0695-44e6-868d-2e8179f40b03'), UUID('a9d5fdfc-8960-487c-a534-81bc2c24caf9'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 9, 49, 1, 183768))
[2026-01-15 09:49:01] INFO [UserService] 用户活动已记录: register, user_id=a9d5fdfc-8960-487c-a534-81bc2c24caf9
[2026-01-15 09:49:01] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 09:49:01] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 09:49:01] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 09:49:01] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000028D9F8022F0>>
[2026-01-15 09:53:51] ERROR [app] fastapi应用关闭
[2026-01-15 09:53:51] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000028D9F8022F0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 09:53:56] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 09:53:56] INFO [app] 正在注册全局异常管理器
[2026-01-15 09:53:56] INFO [app] 注册全局异常管理器成功
[2026-01-15 09:53:56] INFO [app] 正在注册中间件
[2026-01-15 09:53:56] INFO [app] 注册中间件成功
[2026-01-15 09:53:57] INFO [app] 正在启动fastapi应用
[2026-01-15 09:53:57] INFO [app] 正在注册数据库
[2026-01-15 09:53:57] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 09:53:57] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 09:53:57] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 09:53:57] INFO [app] 注册数据库完成
[2026-01-15 09:53:57] INFO [app] 正在注册路由
[2026-01-15 09:53:57] INFO [app] 注册路由完成
[2026-01-15 09:58:51] ERROR [app] fastapi应用关闭
[2026-01-15 09:58:58] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 09:58:58] INFO [app] 正在注册全局异常管理器
[2026-01-15 09:58:58] INFO [app] 注册全局异常管理器成功
[2026-01-15 09:58:58] INFO [app] 正在注册中间件
[2026-01-15 09:58:58] INFO [app] 注册中间件成功
[2026-01-15 09:58:58] INFO [app] 正在启动fastapi应用
[2026-01-15 09:58:58] INFO [app] 正在注册数据库
[2026-01-15 09:58:58] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 09:58:58] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 09:58:58] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 09:58:58] INFO [app] 注册数据库完成
[2026-01-15 09:58:58] INFO [app] 正在注册路由
[2026-01-15 09:58:58] INFO [app] 注册路由完成
[2026-01-15 10:08:48] ERROR [app] fastapi应用关闭
[2026-01-15 10:08:55] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:08:55] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:08:55] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:08:55] INFO [app] 正在注册中间件
[2026-01-15 10:08:55] INFO [app] 注册中间件成功
[2026-01-15 10:08:55] INFO [app] 正在启动fastapi应用
[2026-01-15 10:08:55] INFO [app] 正在注册数据库
[2026-01-15 10:08:55] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:08:55] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:08:55] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:08:55] INFO [app] 注册数据库完成
[2026-01-15 10:08:55] INFO [app] 正在注册路由
[2026-01-15 10:08:55] INFO [app] 注册路由完成
[2026-01-15 10:09:35] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:09:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] [generated in 0.00039s] ('pyan83426@163.com',)
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] [generated in 0.00048s] (UUID('31a709db-8fb3-4914-99ba-1e820e945202'), '彭彦林', 'pyan83426@163.com', '$2b$12$L7gC.akS.dD597H64zTHN.W7bDqYXTIW3cOSUJ/XJtp5snQXEPoEy', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 9, 36, 326223), datetime.datetime(2026, 1, 15, 10, 9, 36, 326223))
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('31a709db-8fb3-4914-99ba-1e820e945202'),)
[2026-01-15 10:09:36] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:09:36] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:09:36] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:09:36] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x00000269F769B2E0>>
[2026-01-15 10:12:25] ERROR [app] fastapi应用关闭
[2026-01-15 10:12:25] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x00000269F769B2E0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:13:02] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:13:02] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:13:02] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:13:02] INFO [app] 正在注册中间件
[2026-01-15 10:13:02] INFO [app] 注册中间件成功
[2026-01-15 10:13:02] INFO [app] 正在启动fastapi应用
[2026-01-15 10:13:02] INFO [app] 正在注册数据库
[2026-01-15 10:13:02] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:13:02] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:13:02] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:13:02] INFO [app] 注册数据库完成
[2026-01-15 10:13:02] INFO [app] 正在注册路由
[2026-01-15 10:13:02] INFO [app] 注册路由完成
[2026-01-15 10:13:37] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:13:37] ERROR [sql] 异步数据库会话出错: UserService.create_user() takes from 2 to 3 positional arguments but 4 were given
[2026-01-15 10:13:54] ERROR [app] fastapi应用关闭
[2026-01-15 10:14:06] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:14:06] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:14:06] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:14:06] INFO [app] 正在注册中间件
[2026-01-15 10:14:06] INFO [app] 注册中间件成功
[2026-01-15 10:14:06] INFO [app] 正在启动fastapi应用
[2026-01-15 10:14:06] INFO [app] 正在注册数据库
[2026-01-15 10:14:06] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:14:06] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:14:06] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:14:06] INFO [app] 注册数据库完成
[2026-01-15 10:14:06] INFO [app] 正在注册路由
[2026-01-15 10:14:06] INFO [app] 注册路由完成
[2026-01-15 10:14:09] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:14:09] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00058s] ('pyan83426@163.com',)
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00093s] (UUID('1ff46f93-4c0f-40bf-b21a-7be0c8c4eaee'), '彭彦林', 'pyan83426@163.com', '$2b$12$MVXkxpCoQ6cKqXSgZG173uq.P5obTetnxQ0bAPy40T31kpdpUYdnC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 14, 10, 326484), datetime.datetime(2026, 1, 15, 10, 14, 10, 326484))
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:14:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00069s] (UUID('1ff46f93-4c0f-40bf-b21a-7be0c8c4eaee'),)
[2026-01-15 10:14:43] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:14:53] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:15:13] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:15:15] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001ABBFF21F30>>
[2026-01-15 10:15:22] ERROR [asyncio] Task exception was never retrieved
future: <Task finished name='Task-15' coro=<AsyncAdapt_asyncpg_connection._terminate_graceful_close() done, defined at D:\code\SmartTCM-Agent-SYSTEM\backend\.renyi\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py:910> exception=TimeoutError()>
[2026-01-15 10:16:29] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:16:29] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:16:29] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:16:29] INFO [app] 正在注册中间件
[2026-01-15 10:16:29] INFO [app] 注册中间件成功
[2026-01-15 10:16:29] INFO [app] 正在启动fastapi应用
[2026-01-15 10:16:29] INFO [app] 正在注册数据库
[2026-01-15 10:16:29] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:16:30] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:16:30] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:16:30] INFO [app] 注册数据库完成
[2026-01-15 10:16:30] INFO [app] 正在注册路由
[2026-01-15 10:16:30] INFO [app] 注册路由完成
[2026-01-15 10:16:33] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [generated in 0.00062s] ('pyan83426@163.com',)
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [generated in 0.00081s] (UUID('05d72a76-30e3-45a7-a9b4-6476b3cd83ad'), '彭彦林', 'pyan83426@163.com', '$2b$12$uU94Iw3ipWJ8HtBixFAp2OUBgm3673cP8f3bSGsQ9bItNAiLAhhSS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 16, 34, 630810), datetime.datetime(2026, 1, 15, 10, 16, 34, 630810))
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:16:34] INFO [sqlalchemy.engine.Engine] [generated in 0.00063s] (UUID('05d72a76-30e3-45a7-a9b4-6476b3cd83ad'),)
[2026-01-15 10:16:57] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:16:59] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:16:59] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:16:59] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002DD07931F30>>
[2026-01-15 10:21:17] ERROR [app] fastapi应用关闭
[2026-01-15 10:21:18] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002DD07931F30>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:21:30] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:21:30] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:21:30] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:21:30] INFO [app] 正在注册中间件
[2026-01-15 10:21:30] INFO [app] 注册中间件成功
[2026-01-15 10:21:30] INFO [app] 正在启动fastapi应用
[2026-01-15 10:21:30] INFO [app] 正在注册数据库
[2026-01-15 10:21:30] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:21:30] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:21:30] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:21:30] INFO [app] 注册数据库完成
[2026-01-15 10:21:30] INFO [app] 正在注册路由
[2026-01-15 10:21:30] INFO [app] 注册路由完成
[2026-01-15 10:22:34] ERROR [app] fastapi应用关闭
[2026-01-15 10:22:45] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:22:45] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:22:45] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:22:45] INFO [app] 正在注册中间件
[2026-01-15 10:22:45] INFO [app] 注册中间件成功
[2026-01-15 10:22:45] INFO [app] 正在启动fastapi应用
[2026-01-15 10:22:45] INFO [app] 正在注册数据库
[2026-01-15 10:22:45] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:22:46] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:22:46] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:22:46] INFO [app] 注册数据库完成
[2026-01-15 10:22:46] INFO [app] 正在注册路由
[2026-01-15 10:22:46] INFO [app] 注册路由完成
[2026-01-15 10:26:17] ERROR [app] fastapi应用关闭
[2026-01-15 10:26:30] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:26:30] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:26:30] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:26:30] INFO [app] 正在注册中间件
[2026-01-15 10:26:30] INFO [app] 注册中间件成功
[2026-01-15 10:26:30] INFO [app] 正在启动fastapi应用
[2026-01-15 10:26:30] INFO [app] 正在注册数据库
[2026-01-15 10:26:30] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:26:30] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:26:30] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:26:30] INFO [app] 注册数据库完成
[2026-01-15 10:26:30] INFO [app] 正在注册路由
[2026-01-15 10:26:30] INFO [app] 注册路由完成
[2026-01-15 10:27:17] ERROR [app] fastapi应用关闭
[2026-01-15 10:27:29] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:27:29] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:27:29] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:27:29] INFO [app] 正在注册中间件
[2026-01-15 10:27:29] INFO [app] 注册中间件成功
[2026-01-15 10:27:29] INFO [app] 正在启动fastapi应用
[2026-01-15 10:27:29] INFO [app] 正在注册数据库
[2026-01-15 10:27:29] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:27:30] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:27:30] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:27:30] INFO [app] 注册数据库完成
[2026-01-15 10:27:30] INFO [app] 正在注册路由
[2026-01-15 10:27:30] INFO [app] 注册路由完成
[2026-01-15 10:32:18] ERROR [app] fastapi应用关闭
[2026-01-15 10:32:29] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:32:29] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:32:29] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:32:29] INFO [app] 正在注册中间件
[2026-01-15 10:32:29] INFO [app] 注册中间件成功
[2026-01-15 10:32:29] INFO [app] 正在启动fastapi应用
[2026-01-15 10:32:29] INFO [app] 正在注册数据库
[2026-01-15 10:32:29] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:32:29] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:32:29] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:32:29] INFO [app] 注册数据库完成
[2026-01-15 10:32:29] INFO [app] 正在注册路由
[2026-01-15 10:32:29] INFO [app] 注册路由完成
[2026-01-15 10:32:32] ERROR [app] fastapi应用关闭
[2026-01-15 10:32:44] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:32:44] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:32:44] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:32:44] INFO [app] 正在注册中间件
[2026-01-15 10:32:44] INFO [app] 注册中间件成功
[2026-01-15 10:32:44] INFO [app] 正在启动fastapi应用
[2026-01-15 10:32:44] INFO [app] 正在注册数据库
[2026-01-15 10:32:44] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:32:44] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:32:44] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:32:44] INFO [app] 注册数据库完成
[2026-01-15 10:32:44] INFO [app] 正在注册路由
[2026-01-15 10:32:44] INFO [app] 注册路由完成
[2026-01-15 10:33:02] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:33:02] INFO [sqlalchemy.engine.Engine] [generated in 0.00062s] ('pyan83426@163.com',)
[2026-01-15 10:33:03] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:33:03] INFO [sqlalchemy.engine.Engine] [generated in 0.00088s] (UUID('c19c4d4f-8f7a-46bb-ba20-6f37fabf5376'), '彭彦林', 'pyan83426@163.com', '$2b$12$KotaHpAY09zehC0lqlOHQu99kIV/o/CCJSRquZXjwKPAKsJycvWDW', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 33, 3, 192021), datetime.datetime(2026, 1, 15, 10, 33, 3, 192021))
[2026-01-15 10:33:03] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:33:03] INFO [sqlalchemy.engine.Engine] [generated in 0.00051s] (UUID('c19c4d4f-8f7a-46bb-ba20-6f37fabf5376'),)
[2026-01-15 10:33:05] ERROR [UserService] 记录用户活动失败: '_AsyncGeneratorContextManager' object has no attribute 'add', user_id=c19c4d4f-8f7a-46bb-ba20-6f37fabf5376, activity_type=register
[2026-01-15 10:33:05] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:33:05] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:33:05] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:33:05] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001D3785CF010>>
[2026-01-15 10:33:38] ERROR [app] fastapi应用关闭
[2026-01-15 10:33:54] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:33:54] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:33:54] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:33:54] INFO [app] 正在注册中间件
[2026-01-15 10:33:54] INFO [app] 注册中间件成功
[2026-01-15 10:33:54] INFO [app] 正在启动fastapi应用
[2026-01-15 10:33:54] INFO [app] 正在注册数据库
[2026-01-15 10:33:54] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:33:54] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:33:54] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:33:54] INFO [app] 注册数据库完成
[2026-01-15 10:33:54] INFO [app] 正在注册路由
[2026-01-15 10:33:54] INFO [app] 注册路由完成
[2026-01-15 10:33:59] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:33:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00050s] ('pyan83426@163.com',)
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] (UUID('eb0cd4da-8a1a-4cb9-83e2-c0735be18c71'), '彭彦林', 'pyan83426@163.com', '$2b$12$2mBOT2FatzNy5uNkx7eF7u4wScTVJAqCAbDsqmXaOB521Ebe.3wpe', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 34, 0, 355701), datetime.datetime(2026, 1, 15, 10, 34, 0, 355701))
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00030s] (UUID('eb0cd4da-8a1a-4cb9-83e2-c0735be18c71'),)
[2026-01-15 10:34:00] ERROR [UserService] 记录用户活动失败: 'NoneType' object is not callable, user_id=eb0cd4da-8a1a-4cb9-83e2-c0735be18c71, activity_type=register
[2026-01-15 10:34:00] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:34:00] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:34:00] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:34:00] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000028C579F22F0>>
[2026-01-15 10:35:53] ERROR [app] fastapi应用关闭
[2026-01-15 10:35:53] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000028C579F22F0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:36:00] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:36:00] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:36:00] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:36:00] INFO [app] 正在注册中间件
[2026-01-15 10:36:00] INFO [app] 注册中间件成功
[2026-01-15 10:36:00] INFO [app] 正在启动fastapi应用
[2026-01-15 10:36:00] INFO [app] 正在注册数据库
[2026-01-15 10:36:00] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:36:00] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:36:00] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:36:00] INFO [app] 注册数据库完成
[2026-01-15 10:36:00] INFO [app] 正在注册路由
[2026-01-15 10:36:00] INFO [app] 注册路由完成
[2026-01-15 10:36:04] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00046s] (UUID('9be514bc-b359-40c8-aefd-e51423c1467c'), '彭彦林', 'pyan83426@163.com', '$2b$12$8OgrMJhvw9k7wCz7O377c.eDg9LaCzvSb62bc2.xdAAkRI8B7TXoS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 36, 4, 739038), datetime.datetime(2026, 1, 15, 10, 36, 4, 739038))
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('9be514bc-b359-40c8-aefd-e51423c1467c'),)
[2026-01-15 10:36:04] ERROR [UserService] 记录用户活动失败: 'coroutine' object does not support the asynchronous context manager protocol, user_id=9be514bc-b359-40c8-aefd-e51423c1467c, activity_type=register
[2026-01-15 10:36:04] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:36:04] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:36:04] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:36:04] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000029F7A1923E0>>
[2026-01-15 10:36:48] ERROR [app] fastapi应用关闭
[2026-01-15 10:36:48] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000029F7A1923E0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:36:56] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:36:56] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:36:56] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:36:56] INFO [app] 正在注册中间件
[2026-01-15 10:36:56] INFO [app] 注册中间件成功
[2026-01-15 10:36:56] INFO [app] 正在启动fastapi应用
[2026-01-15 10:36:56] INFO [app] 正在注册数据库
[2026-01-15 10:36:56] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:36:57] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:36:57] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:36:57] INFO [app] 注册数据库完成
[2026-01-15 10:36:57] INFO [app] 正在注册路由
[2026-01-15 10:36:57] INFO [app] 注册路由完成
[2026-01-15 10:36:59] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00038s] ('pyan83426@163.com',)
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00052s] (UUID('d3ef5429-c3ba-47ad-aa00-fc102451a706'), '彭彦林', 'pyan83426@163.com', '$2b$12$CZ1nFMQFGWvZ4xADh0FAyOPT9tDl0jOH6KE8VW1B9/Ehf/vZ3cMuC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 37, 0, 454918), datetime.datetime(2026, 1, 15, 10, 37, 0, 454918))
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] [generated in 0.00032s] (UUID('d3ef5429-c3ba-47ad-aa00-fc102451a706'),)
[2026-01-15 10:37:00] ERROR [UserService] 记录用户活动失败: 'NoneType' object is not callable, user_id=d3ef5429-c3ba-47ad-aa00-fc102451a706, activity_type=register
[2026-01-15 10:37:00] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:37:00] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:37:00] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:37:00] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000024C501423E0>>
[2026-01-15 10:39:31] ERROR [app] fastapi应用关闭
[2026-01-15 10:39:31] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000024C501423E0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:39:38] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:39:38] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:39:38] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:39:38] INFO [app] 正在注册中间件
[2026-01-15 10:39:38] INFO [app] 注册中间件成功
[2026-01-15 10:39:38] INFO [app] 正在启动fastapi应用
[2026-01-15 10:39:38] INFO [app] 正在注册数据库
[2026-01-15 10:39:38] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:39:38] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:39:38] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:39:38] INFO [app] 注册数据库完成
[2026-01-15 10:39:38] INFO [app] 正在注册路由
[2026-01-15 10:39:39] INFO [app] 注册路由完成
[2026-01-15 10:39:51] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [generated in 0.00053s] ('pyan83426@163.com',)
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [generated in 0.00042s] (UUID('251ab437-2225-43ef-943d-34e1ab3501d9'), '彭彦林', 'pyan83426@163.com', '$2b$12$yd9hjuB6OW/5bwlzmbC1vOA168CToYLo/RreGoSKmZ/ddo2o6DhmS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 39, 51, 991348), datetime.datetime(2026, 1, 15, 10, 39, 51, 991348))
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:39:51] INFO [sqlalchemy.engine.Engine] [generated in 0.00029s] (UUID('251ab437-2225-43ef-943d-34e1ab3501d9'),)
[2026-01-15 10:39:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:39:52] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:39:52] INFO [sqlalchemy.engine.Engine] [generated in 0.00040s] (UUID('68fc69ca-4a4d-425d-a7e6-4687647c63a6'), UUID('251ab437-2225-43ef-943d-34e1ab3501d9'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 39, 52, 887))
[2026-01-15 10:39:52] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:39:52] ERROR [UserService] 记录用户活动失败: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "user_activities" violates foreign key constraint "user_activities_user_id_fkey"
DETAIL:  Key (user_id)=(251ab437-2225-43ef-943d-34e1ab3501d9) is not present in table "users".
[SQL: INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('68fc69ca-4a4d-425d-a7e6-4687647c63a6'), UUID('251ab437-2225-43ef-943d-34e1ab3501d9'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 39, 52, 887))]
(Background on this error at: https://sqlalche.me/e/20/gkpj), user_id=251ab437-2225-43ef-943d-34e1ab3501d9, activity_type=register
[2026-01-15 10:39:52] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:39:52] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:39:52] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:39:52] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002C0416922F0>>
[2026-01-15 10:44:32] ERROR [app] fastapi应用关闭
[2026-01-15 10:44:32] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002C0416922F0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:44:38] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:44:38] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:44:38] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:44:38] INFO [app] 正在注册中间件
[2026-01-15 10:44:38] INFO [app] 注册中间件成功
[2026-01-15 10:44:38] INFO [app] 正在启动fastapi应用
[2026-01-15 10:44:38] INFO [app] 正在注册数据库
[2026-01-15 10:44:38] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:44:38] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:44:38] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:44:38] INFO [app] 注册数据库完成
[2026-01-15 10:44:38] INFO [app] 正在注册路由
[2026-01-15 10:44:38] INFO [app] 注册路由完成
[2026-01-15 10:48:09] ERROR [app] fastapi应用关闭
[2026-01-15 10:48:15] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:48:15] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:48:15] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:48:15] INFO [app] 正在注册中间件
[2026-01-15 10:48:15] INFO [app] 注册中间件成功
[2026-01-15 10:48:15] INFO [app] 正在启动fastapi应用
[2026-01-15 10:48:15] INFO [app] 正在注册数据库
[2026-01-15 10:48:15] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:48:16] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:48:16] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:48:16] ERROR [app] fastapi应用关闭
[2026-01-15 10:51:52] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:51:52] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:51:52] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:51:52] INFO [app] 正在注册中间件
[2026-01-15 10:51:52] INFO [app] 注册中间件成功
[2026-01-15 10:51:52] INFO [app] 正在启动fastapi应用
[2026-01-15 10:51:52] INFO [app] 正在注册数据库
[2026-01-15 10:51:52] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:51:52] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:51:52] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00039s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.007159s ago] ('patients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.00857s ago] ('user_sessions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.009942s ago] ('user_states', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0114s ago] ('user_activities', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01271s ago] ('refresh_tokens', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01384s ago] ('conversations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01464s ago] ('messages', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0158s ago] ('medical_cases', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01668s ago] ('symptoms', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01785s ago] ('syndromes', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0187s ago] ('medical_records', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.01948s ago] ('tongue_analysis', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02009s ago] ('prescription_recommendations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02068s ago] ('herbs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02128s ago] ('herb_inventory', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.022s ago] ('prescriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.0226s ago] ('classic_texts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02318s ago] ('system_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02376s ago] ('model_providers', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02433s ago] ('model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [cached since 0.02503s ago] ('user_model_configs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] ('devicetype', 'pg_catalog')
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE users (
	id UUID NOT NULL, 
	username VARCHAR(50) NOT NULL, 
	email VARCHAR(100) NOT NULL, 
	password_hash VARCHAR(255) NOT NULL, 
	role VARCHAR NOT NULL, 
	real_name VARCHAR(50), 
	phone VARCHAR(20), 
	gender VARCHAR(10), 
	birth_date DATE, 
	constitution_type VARCHAR(50), 
	avatar_url VARCHAR(255), 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	UNIQUE (email)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00032s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_users_role ON users (role)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_users_username ON users (username)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_users_email ON users (email)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE user_states (
	app_name VARCHAR(128) NOT NULL, 
	user_id UUID NOT NULL, 
	state JSON, 
	update_time TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (app_name, user_id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_states_app_user ON user_states (app_name, user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_states_update_time ON user_states (update_time)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_states_user_id ON user_states (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00023s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_states_app_name ON user_states (app_name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_states_app_name_user_id ON user_states (app_name, user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE symptoms (
	id UUID NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	category VARCHAR(50) NOT NULL, 
	description VARCHAR, 
	severity_levels JSON, 
	related_syndromes JSON, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_symptoms_is_active ON symptoms (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_symptoms_category ON symptoms (category)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_symptoms_name ON symptoms (name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00025s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE syndromes (
	id UUID NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	category VARCHAR(50) NOT NULL, 
	description VARCHAR, 
	main_symptoms JSON, 
	treatment_principle VARCHAR, 
	common_prescriptions JSON, 
	precautions VARCHAR, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_syndromes_name ON syndromes (name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_syndromes_category ON syndromes (category)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_syndromes_is_active ON syndromes (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE medical_records (
	id UUID NOT NULL, 
	case_title VARCHAR(200) NOT NULL, 
	patient_age INTEGER, 
	patient_gender VARCHAR(10), 
	chief_complaint VARCHAR NOT NULL, 
	present_illness VARCHAR NOT NULL, 
	symptoms JSON, 
	tongue_pulse VARCHAR, 
	syndrome_diagnosis VARCHAR(100) NOT NULL, 
	treatment_principle VARCHAR, 
	prescription VARCHAR NOT NULL, 
	dosage_instruction VARCHAR, 
	treatment_course VARCHAR, 
	outcome VARCHAR, 
	doctor_name VARCHAR(50), 
	hospital_name VARCHAR(100), 
	case_source VARCHAR(100), 
	tags JSON, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_records_doctor_name ON medical_records (doctor_name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_records_hospital_name ON medical_records (hospital_name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_records_is_active ON medical_records (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_records_syndrome_diagnosis ON medical_records (syndrome_diagnosis)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE herbs (
	id UUID NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	pinyin VARCHAR(100), 
	latin_name VARCHAR(100), 
	category VARCHAR(50), 
	nature VARCHAR(20), 
	flavor VARCHAR(50), 
	meridian VARCHAR(100), 
	effect VARCHAR, 
	indication VARCHAR, 
	usage_dosage VARCHAR, 
	contraindications VARCHAR, 
	incompatibilities VARCHAR, 
	processing_method VARCHAR, 
	storage_method VARCHAR, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herbs_name ON herbs (name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herbs_category ON herbs (category)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herbs_nature ON herbs (nature)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herbs_is_active ON herbs (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE prescriptions (
	id UUID NOT NULL, 
	name VARCHAR(100) NOT NULL, 
	source VARCHAR(100), 
	category VARCHAR(50), 
	composition JSON, 
	preparation_method VARCHAR, 
	usage_dosage VARCHAR, 
	indication VARCHAR, 
	syndrome_adaptation VARCHAR, 
	contraindications VARCHAR, 
	modifications VARCHAR, 
	clinical_notes VARCHAR, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescriptions_category ON prescriptions (category)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00023s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescriptions_source ON prescriptions (source)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescriptions_is_active ON prescriptions (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescriptions_name ON prescriptions (name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE classic_texts (
	id UUID NOT NULL, 
	title VARCHAR(100) NOT NULL, 
	chapter VARCHAR(100), 
	section VARCHAR(100), 
	article_number VARCHAR(20), 
	content VARCHAR NOT NULL, 
	translation VARCHAR, 
	annotation VARCHAR, 
	clinical_application VARCHAR, 
	related_syndromes JSON, 
	related_prescriptions JSON, 
	source_url VARCHAR(255), 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00027s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_classic_texts_chapter ON classic_texts (chapter)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_classic_texts_article_number ON classic_texts (article_number)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_classic_texts_title ON classic_texts (title)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_classic_texts_is_active ON classic_texts (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE system_configs (
	id UUID NOT NULL, 
	config_key VARCHAR(100) NOT NULL, 
	config_value VARCHAR, 
	config_type VARCHAR(20) NOT NULL, 
	description VARCHAR, 
	is_active BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (config_key)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00026s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_system_configs_is_active ON system_configs (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_system_configs_config_key ON system_configs (config_key)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE model_providers (
	id UUID NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	label VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	icon TEXT, 
	icon_background VARCHAR(20), 
	default_base_url VARCHAR(500), 
	supported_model_types JSON, 
	help_url VARCHAR(500), 
	is_builtin BOOLEAN NOT NULL, 
	is_enabled BOOLEAN NOT NULL, 
	position INTEGER NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_providers_enabled ON model_providers (is_enabled)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_providers_name ON model_providers (name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00033s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_providers_position ON model_providers (position)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE patients (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	patient_code VARCHAR(20) NOT NULL, 
	medical_history VARCHAR, 
	family_history VARCHAR, 
	allergy_info VARCHAR, 
	current_medications VARCHAR, 
	emergency_contact_name VARCHAR(50), 
	emergency_contact_phone VARCHAR(20), 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	UNIQUE (patient_code)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00026s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_patients_patient_code ON patients (patient_code)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00031s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_patients_user_id ON patients (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE user_sessions (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	session_token VARCHAR(255) NOT NULL, 
	access_token VARCHAR(500), 
	refresh_token VARCHAR(500), 
	device_id VARCHAR(255), 
	device_type devicetype, 
	user_agent VARCHAR, 
	ip_address VARCHAR, 
	location JSON, 
	expires_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	last_activity_at TIMESTAMP WITHOUT TIME ZONE, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	is_active BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	UNIQUE (session_token)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_sessions_active ON user_sessions (is_active)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00023s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_sessions_expires_at ON user_sessions (expires_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_sessions_token ON user_sessions (session_token)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00026s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_sessions_user_id ON user_sessions (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_sessions_device_id ON user_sessions (device_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00027s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE conversations (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	session_id VARCHAR(50) NOT NULL, 
	conversation_type VARCHAR(30) NOT NULL, 
	title VARCHAR(200), 
	status VARCHAR NOT NULL, 
	total_messages INTEGER NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_conversations_user_id ON conversations (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00027s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_conversations_session_id ON conversations (session_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_conversations_conversation_type ON conversations (conversation_type)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_conversations_status ON conversations (status)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_conversations_created_at ON conversations (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE tongue_analysis (
	id UUID NOT NULL, 
	user_id UUID, 
	image_url VARCHAR(255) NOT NULL, 
	analysis_result JSON, 
	color_analysis VARCHAR(100), 
	coating_thickness VARCHAR(50), 
	coating_moisture VARCHAR(50), 
	coating_color VARCHAR(50), 
	tongue_shape VARCHAR(50), 
	syndrome_suggestion VARCHAR, 
	confidence_score NUMERIC, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_tongue_analysis_user_id ON tongue_analysis (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_tongue_analysis_created_at ON tongue_analysis (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE herb_inventory (
	id UUID NOT NULL, 
	herb_id UUID NOT NULL, 
	batch_number VARCHAR(50), 
	supplier VARCHAR(100), 
	purchase_date DATE, 
	expiry_date DATE, 
	quantity NUMERIC NOT NULL, 
	unit VARCHAR(20) NOT NULL, 
	unit_price NUMERIC, 
	quality_grade VARCHAR(20), 
	storage_location VARCHAR(100), 
	status VARCHAR NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(herb_id) REFERENCES herbs (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herb_inventory_expiry_date ON herb_inventory (expiry_date)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herb_inventory_batch_number ON herb_inventory (batch_number)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herb_inventory_status ON herb_inventory (status)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_herb_inventory_herb_id ON herb_inventory (herb_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE model_configs (
	id UUID NOT NULL, 
	provider_id UUID NOT NULL, 
	model_name VARCHAR(100) NOT NULL, 
	label VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	model_type VARCHAR(20) NOT NULL, 
	features JSON, 
	context_window INTEGER NOT NULL, 
	max_output_tokens INTEGER NOT NULL, 
	default_temperature FLOAT NOT NULL, 
	default_top_p FLOAT NOT NULL, 
	default_max_tokens INTEGER NOT NULL, 
	default_parameters JSON, 
	attributes JSON, 
	pricing JSON, 
	is_enabled BOOLEAN NOT NULL, 
	position INTEGER NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(provider_id) REFERENCES model_providers (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00030s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_models_name ON model_configs (model_name)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_models_enabled ON model_configs (is_enabled)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_models_provider_id ON model_configs (provider_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE user_activities (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	session_id UUID, 
	activity_type VARCHAR, 
	activity_data JSON, 
	ip_address VARCHAR, 
	user_agent VARCHAR, 
	resource VARCHAR(255), 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(session_id) REFERENCES user_sessions (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_activities_type ON user_activities (activity_type)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_activities_created_at ON user_activities (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_activities_user_id ON user_activities (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE refresh_tokens (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	token_hash VARCHAR(255) NOT NULL, 
	session_id UUID, 
	expires_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	revoked_at TIMESTAMP WITHOUT TIME ZONE, 
	is_revoked BOOLEAN NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	UNIQUE (token_hash), 
	FOREIGN KEY(session_id) REFERENCES user_sessions (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00027s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_refresh_tokens_token_hash ON refresh_tokens (token_hash)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_refresh_tokens_revoked ON refresh_tokens (is_revoked)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_refresh_tokens_user_id ON refresh_tokens (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_refresh_tokens_expires_at ON refresh_tokens (expires_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	id UUID NOT NULL, 
	conversation_id UUID NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content VARCHAR NOT NULL, 
	message_type VARCHAR(20) NOT NULL, 
	message_metadata JSON, 
	is_deleted BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(conversation_id) REFERENCES conversations (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_messages_role ON messages (role)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_messages_message_type ON messages (message_type)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00027s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_messages_conversation_id ON messages (conversation_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00025s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_messages_created_at ON messages (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE medical_cases (
	id UUID NOT NULL, 
	patient_id UUID NOT NULL, 
	case_code VARCHAR(20) NOT NULL, 
	chief_complaint VARCHAR NOT NULL, 
	present_illness VARCHAR, 
	symptoms JSON, 
	tongue_description VARCHAR, 
	pulse_description VARCHAR, 
	syndrome_type VARCHAR(100), 
	syndrome_confidence NUMERIC, 
	treatment_principle VARCHAR, 
	prescription_name VARCHAR(100), 
	prescription_ingredients JSON, 
	dosage_instruction VARCHAR, 
	precautions VARCHAR, 
	follow_up_date DATE, 
	status VARCHAR NOT NULL, 
	doctor_notes VARCHAR, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(patient_id) REFERENCES patients (id), 
	UNIQUE (case_code)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00030s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_cases_case_code ON medical_cases (case_code)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_cases_syndrome_type ON medical_cases (syndrome_type)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_cases_status ON medical_cases (status)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_cases_created_at ON medical_cases (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00023s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_medical_cases_patient_id ON medical_cases (patient_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00021s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE user_model_configs (
	id UUID NOT NULL, 
	user_id UUID NOT NULL, 
	provider_id UUID NOT NULL, 
	model_config_id UUID, 
	custom_model_name VARCHAR(100), 
	api_key TEXT NOT NULL, 
	base_url VARCHAR(500), 
	custom_temperature FLOAT, 
	custom_top_p FLOAT, 
	custom_max_tokens INTEGER, 
	custom_parameters JSON, 
	alias VARCHAR(100), 
	is_default BOOLEAN NOT NULL, 
	is_enabled BOOLEAN NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(provider_id) REFERENCES model_providers (id), 
	FOREIGN KEY(model_config_id) REFERENCES model_configs (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00022s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_models_default ON user_model_configs (user_id, is_default)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_models_user_id ON user_model_configs (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_user_models_provider ON user_model_configs (provider_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00023s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] 
CREATE TABLE prescription_recommendations (
	id UUID NOT NULL, 
	case_id UUID, 
	user_id UUID, 
	prescription_id UUID, 
	prescription_name VARCHAR(100) NOT NULL, 
	syndrome_type VARCHAR(100), 
	recommendation_reason VARCHAR, 
	dosage_instruction VARCHAR, 
	precautions VARCHAR, 
	confidence_score NUMERIC, 
	status VARCHAR NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(case_id) REFERENCES medical_cases (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(prescription_id) REFERENCES prescriptions (id)
)


[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00024s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescription_recommendations_case_id ON prescription_recommendations (case_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00019s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescription_recommendations_user_id ON prescription_recommendations (user_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00020s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescription_recommendations_prescription_id ON prescription_recommendations (prescription_id)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescription_recommendations_status ON prescription_recommendations (status)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] CREATE INDEX idx_prescription_recommendations_created_at ON prescription_recommendations (created_at)
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] [no key 0.00018s] ()
[2026-01-15 10:51:53] INFO [sql] 数据库表创建/检查完成
[2026-01-15 10:51:53] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 10:51:53] INFO [app] 注册数据库完成
[2026-01-15 10:51:53] INFO [app] 正在注册路由
[2026-01-15 10:51:53] INFO [app] 注册路由完成
[2026-01-15 10:52:05] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:52:05] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:52:05] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:52:05] INFO [sqlalchemy.engine.Engine] [generated in 0.00028s] ('pyan83426@163.com',)
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] [generated in 0.00032s] (UUID('cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8'), '彭彦林', 'pyan83426@163.com', '$2b$12$zmoRo9zr8H2wWQv.56iOIeyRc7PugpIrFkWrffPpfuYkhg6u8Rf6m', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 52, 6, 251160), datetime.datetime(2026, 1, 15, 10, 52, 6, 251160))
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8'),)
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('a0880caf-9743-4734-ae71-ec4910bbc828'), UUID('cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 52, 6, 261462))
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:52:06] ERROR [UserService] 记录用户活动失败: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "user_activities" violates foreign key constraint "user_activities_user_id_fkey"
DETAIL:  Key (user_id)=(cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8) is not present in table "users".
[SQL: INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('a0880caf-9743-4734-ae71-ec4910bbc828'), UUID('cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 52, 6, 261462))]
(Background on this error at: https://sqlalche.me/e/20/gkpj), user_id=cfe92ff2-d5d0-450d-b210-1ba1a6aa3ff8, activity_type=register
[2026-01-15 10:52:06] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:52:06] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:52:06] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:52:06] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000011D3B7C9120>>
[2026-01-15 10:52:23] ERROR [app] fastapi应用关闭
[2026-01-15 10:52:23] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000011D3B7C9120>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:52:28] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:52:28] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:52:28] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:52:28] INFO [app] 正在注册中间件
[2026-01-15 10:52:28] INFO [app] 注册中间件成功
[2026-01-15 10:52:28] INFO [app] 正在启动fastapi应用
[2026-01-15 10:52:28] INFO [app] 正在注册数据库
[2026-01-15 10:52:28] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:52:28] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:52:28] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:52:28] INFO [app] 注册数据库完成
[2026-01-15 10:52:28] INFO [app] 正在注册路由
[2026-01-15 10:52:28] INFO [app] 注册路由完成
[2026-01-15 10:56:47] ERROR [app] fastapi应用关闭
[2026-01-15 10:56:54] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:56:54] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:56:54] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:56:54] INFO [app] 正在注册中间件
[2026-01-15 10:56:54] INFO [app] 注册中间件成功
[2026-01-15 10:56:54] INFO [app] 正在启动fastapi应用
[2026-01-15 10:56:54] INFO [app] 正在注册数据库
[2026-01-15 10:56:54] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:56:54] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:56:54] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:56:54] INFO [app] 注册数据库完成
[2026-01-15 10:56:54] INFO [app] 正在注册路由
[2026-01-15 10:56:54] INFO [app] 注册路由完成
[2026-01-15 10:57:01] ERROR [app] fastapi应用关闭
[2026-01-15 10:57:08] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:57:08] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:57:08] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:57:08] INFO [app] 正在注册中间件
[2026-01-15 10:57:08] INFO [app] 注册中间件成功
[2026-01-15 10:57:08] INFO [app] 正在启动fastapi应用
[2026-01-15 10:57:08] INFO [app] 正在注册数据库
[2026-01-15 10:57:08] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:57:08] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:57:08] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:57:08] INFO [app] 注册数据库完成
[2026-01-15 10:57:08] INFO [app] 正在注册路由
[2026-01-15 10:57:08] INFO [app] 注册路由完成
[2026-01-15 10:57:13] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00037s] ('pyan83426@163.com',)
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('7962a54d-9937-4818-a043-e1fd8637ff3f'), '彭彦林', 'pyan83426@163.com', '$2b$12$XaBg6CZx2yTmoNGgzR6/a.lvkVjDDaXgN9/.ANoJXXNCrIyelAzhq', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 57, 13, 534042), datetime.datetime(2026, 1, 15, 10, 57, 13, 534042))
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00025s] (UUID('7962a54d-9937-4818-a043-e1fd8637ff3f'),)
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('98591bf4-b4b2-49b7-a9f4-bb2a0b5b3ce2'), UUID('7962a54d-9937-4818-a043-e1fd8637ff3f'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 57, 13, 542256))
[2026-01-15 10:57:13] INFO [UserService] 用户活动已记录: register, user_id=7962a54d-9937-4818-a043-e1fd8637ff3f
[2026-01-15 10:57:13] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:57:13] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:57:13] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:57:13] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001C7FE162200>>
[2026-01-15 10:59:03] ERROR [app] fastapi应用关闭
[2026-01-15 10:59:03] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001C7FE162200>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 10:59:10] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 10:59:10] INFO [app] 正在注册全局异常管理器
[2026-01-15 10:59:10] INFO [app] 注册全局异常管理器成功
[2026-01-15 10:59:10] INFO [app] 正在注册中间件
[2026-01-15 10:59:10] INFO [app] 注册中间件成功
[2026-01-15 10:59:10] INFO [app] 正在启动fastapi应用
[2026-01-15 10:59:10] INFO [app] 正在注册数据库
[2026-01-15 10:59:10] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 10:59:11] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 10:59:11] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 10:59:11] INFO [app] 注册数据库完成
[2026-01-15 10:59:11] INFO [app] 正在注册路由
[2026-01-15 10:59:11] INFO [app] 注册路由完成
[2026-01-15 10:59:16] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00030s] ('pyan83426@163.com',)
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00051s] (UUID('29a6bdcf-ae90-4e7a-a68b-167b0664b361'), '彭彦林', 'pyan83426@163.com', '$2b$12$Ym5Wc8n7l6zlLTMgh8defu5RNI6QyQoAMMx5YVhx69QtmpgnUrMAq', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 10, 59, 17, 462538), datetime.datetime(2026, 1, 15, 10, 59, 17, 462538))
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('29a6bdcf-ae90-4e7a-a68b-167b0664b361'),)
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('c792bf3a-0ac0-48c1-bf27-6d878e7d046c'), UUID('29a6bdcf-ae90-4e7a-a68b-167b0664b361'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 10, 59, 17, 471783))
[2026-01-15 10:59:17] INFO [UserService] 用户活动已记录: register, user_id=29a6bdcf-ae90-4e7a-a68b-167b0664b361
[2026-01-15 10:59:17] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 10:59:17] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 10:59:17] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 10:59:17] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001A73EE022F0>>
[2026-01-15 11:04:03] ERROR [app] fastapi应用关闭
[2026-01-15 11:04:03] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001A73EE022F0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 11:04:10] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:04:10] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:04:10] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:04:10] INFO [app] 正在注册中间件
[2026-01-15 11:04:10] INFO [app] 注册中间件成功
[2026-01-15 11:04:10] INFO [app] 正在启动fastapi应用
[2026-01-15 11:04:10] INFO [app] 正在注册数据库
[2026-01-15 11:04:10] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:04:10] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:04:10] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:04:10] INFO [app] 注册数据库完成
[2026-01-15 11:04:10] INFO [app] 正在注册路由
[2026-01-15 11:04:10] INFO [app] 注册路由完成
[2026-01-15 11:07:51] ERROR [app] fastapi应用关闭
[2026-01-15 11:09:04] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:09:04] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:09:04] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:09:04] INFO [app] 正在注册中间件
[2026-01-15 11:09:04] INFO [app] 注册中间件成功
[2026-01-15 11:09:04] INFO [app] 正在启动fastapi应用
[2026-01-15 11:09:04] INFO [app] 正在注册数据库
[2026-01-15 11:09:04] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:09:04] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:09:04] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:09:04] INFO [app] 注册数据库完成
[2026-01-15 11:09:04] INFO [app] 正在注册路由
[2026-01-15 11:09:04] INFO [app] 注册路由完成
[2026-01-15 11:09:08] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:09:08] INFO [sqlalchemy.engine.Engine] [generated in 0.00043s] ('pyan83426@163.com',)
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('04c37046-5932-45f0-b8e2-ff2222324409'), '彭彦林', 'pyan83426@163.com', '$2b$12$soaPVg7xUrQ5FKHF05r0numh0hx8mDCrT9juX7cZCpfLRVDGmmzPm', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 9, 9, 121150), datetime.datetime(2026, 1, 15, 11, 9, 9, 121150))
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] [generated in 0.00027s] (UUID('04c37046-5932-45f0-b8e2-ff2222324409'),)
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('8b5e9225-0699-4a3e-955b-670aa1fa92a7'), UUID('04c37046-5932-45f0-b8e2-ff2222324409'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 9, 9, 136956))
[2026-01-15 11:09:09] INFO [UserService] 用户活动已记录: register, user_id=04c37046-5932-45f0-b8e2-ff2222324409
[2026-01-15 11:09:09] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:09:09] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:09:09] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:10:59] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] [cached since 110.4s ago] ('pyan83426@163.com',)
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] [cached since 110.4s ago] (UUID('19ee4edb-07fa-4008-adb6-e64e09df60fe'), '彭彦林', 'pyan83426@163.com', '$2b$12$4rGKe32q83nUx0nWMuwgHOYnQHpBsBP/DWD4CfVzwL1FDq502Y.f6', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 10, 59, 539989), datetime.datetime(2026, 1, 15, 11, 10, 59, 539989))
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] [cached since 110.4s ago] (UUID('19ee4edb-07fa-4008-adb6-e64e09df60fe'),)
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] [cached since 110.4s ago] (UUID('f07a0f11-5ad4-4529-ba5f-5a7d0f38c10d'), UUID('19ee4edb-07fa-4008-adb6-e64e09df60fe'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 10, 59, 545021))
[2026-01-15 11:10:59] INFO [UserService] 用户活动已记录: register, user_id=19ee4edb-07fa-4008-adb6-e64e09df60fe
[2026-01-15 11:10:59] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:10:59] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:10:59] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:12:51] ERROR [app] fastapi应用关闭
[2026-01-15 11:13:04] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:13:04] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:13:04] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:13:04] INFO [app] 正在注册中间件
[2026-01-15 11:13:04] INFO [app] 注册中间件成功
[2026-01-15 11:13:04] INFO [app] 正在启动fastapi应用
[2026-01-15 11:13:04] INFO [app] 正在注册数据库
[2026-01-15 11:13:04] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:13:04] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:13:04] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:13:04] INFO [app] 注册数据库完成
[2026-01-15 11:13:04] INFO [app] 正在注册路由
[2026-01-15 11:13:04] INFO [app] 注册路由完成
[2026-01-15 11:13:32] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00085s] ('pyan83426@163.com',)
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00089s] (UUID('95fe49fb-bd78-469b-b0c0-79961e47eb52'), '彭彦林', 'pyan83426@163.com', '$2b$12$QwzQtfgKX/BtfJAZUMzFUOVXc4bXgbmutUVF1cZ5Csxmd/.ROoqdC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 13, 33, 591178), datetime.datetime(2026, 1, 15, 11, 13, 33, 591178))
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00050s] (UUID('95fe49fb-bd78-469b-b0c0-79961e47eb52'),)
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00156s] (UUID('ba06b755-1b12-4c02-aa91-6077cb998914'), UUID('95fe49fb-bd78-469b-b0c0-79961e47eb52'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 13, 33, 607045))
[2026-01-15 11:13:33] INFO [UserService] 用户活动已记录: register, user_id=95fe49fb-bd78-469b-b0c0-79961e47eb52
[2026-01-15 11:13:33] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:13:33] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:13:33] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:13:49] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:13:58] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:14:01] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:14:03] INFO [sqlalchemy.engine.Engine] [cached since 30.51s ago] ('pyan83426@163.com',)
[2026-01-15 11:14:19] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:14:20] INFO [sqlalchemy.engine.Engine] [cached since 47.37s ago] (UUID('c0be25a8-e7e9-4e4b-9d78-33427084a35d'), '彭彦林', 'pyan83426@163.com', '$2b$12$hb/4Fm.eNJkx3YA9WL4U7ukHVmu9rTM9br9XYvtE5zjrU..ASmyW.', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 14, 17, 914661), datetime.datetime(2026, 1, 15, 11, 14, 17, 916721))
[2026-01-15 11:14:25] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:14:27] INFO [sqlalchemy.engine.Engine] [cached since 54.06s ago] (UUID('c0be25a8-e7e9-4e4b-9d78-33427084a35d'),)
[2026-01-15 11:14:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:14:41] INFO [sqlalchemy.engine.Engine] [cached since 67.4s ago] (UUID('1f796061-0310-44c1-b88c-296bf3e2d9a9'), UUID('c0be25a8-e7e9-4e4b-9d78-33427084a35d'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 14, 37, 240419))
[2026-01-15 11:14:44] INFO [UserService] 用户活动已记录: register, user_id=c0be25a8-e7e9-4e4b-9d78-33427084a35d
[2026-01-15 11:14:49] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:14:52] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:15:13] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:20:18] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:20:18] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:20:18] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:20:18] INFO [app] 正在注册中间件
[2026-01-15 11:20:18] INFO [app] 注册中间件成功
[2026-01-15 11:20:18] INFO [app] 正在启动fastapi应用
[2026-01-15 11:20:18] INFO [app] 正在注册数据库
[2026-01-15 11:20:18] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:20:18] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:20:18] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:20:18] INFO [app] 注册数据库完成
[2026-01-15 11:20:18] INFO [app] 正在注册路由
[2026-01-15 11:20:18] INFO [app] 注册路由完成
[2026-01-15 11:20:41] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00038s] (UUID('a4fcf27f-433c-44a0-80a7-b1931a1ea69c'), '彭彦林', 'pyan83426@163.com', '$2b$12$zqs2P4EPr7bDQafhPvG4A.P10KdTstyY7SghneshfzwhsPIGF2hnC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 20, 42, 505519), datetime.datetime(2026, 1, 15, 11, 20, 42, 505519))
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('a4fcf27f-433c-44a0-80a7-b1931a1ea69c'),)
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00043s] (UUID('d7ada297-bef0-494f-ab64-7dd6871ee29a'), UUID('a4fcf27f-433c-44a0-80a7-b1931a1ea69c'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 20, 42, 515565))
[2026-01-15 11:20:42] INFO [UserService] 用户活动已记录: register, user_id=a4fcf27f-433c-44a0-80a7-b1931a1ea69c
[2026-01-15 11:20:42] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:20:42] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:20:42] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:20:51] ERROR [app] fastapi应用关闭
[2026-01-15 11:20:57] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:20:57] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:20:57] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:20:57] INFO [app] 正在注册中间件
[2026-01-15 11:20:57] INFO [app] 注册中间件成功
[2026-01-15 11:20:57] INFO [app] 正在启动fastapi应用
[2026-01-15 11:20:57] INFO [app] 正在注册数据库
[2026-01-15 11:20:57] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:20:57] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:20:57] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:20:57] INFO [app] 注册数据库完成
[2026-01-15 11:20:57] INFO [app] 正在注册路由
[2026-01-15 11:20:57] INFO [app] 注册路由完成
[2026-01-15 11:21:57] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:21:57] INFO [sqlalchemy.engine.Engine] [generated in 0.00044s] ('pyan83426@163.com',)
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00055s] (UUID('94072f5a-3278-4ccf-ad48-c084feb7f195'), '彭彦林', 'pyan83426@163.com', '$2b$12$S1ywQxcxNd7A55yy1gW5IOyOKjnPb0PYojk7nx54WLYPwTt32PVlC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 21, 58, 153836), datetime.datetime(2026, 1, 15, 11, 21, 58, 153836))
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00027s] (UUID('94072f5a-3278-4ccf-ad48-c084feb7f195'),)
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00045s] (UUID('6f263004-5d76-4d05-bddb-3673a821cff2'), UUID('94072f5a-3278-4ccf-ad48-c084feb7f195'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 21, 58, 166140))
[2026-01-15 11:21:58] INFO [UserService] 用户活动已记录: register, user_id=94072f5a-3278-4ccf-ad48-c084feb7f195
[2026-01-15 11:21:58] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:21:58] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:21:58] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:22:17] ERROR [app] fastapi应用关闭
[2026-01-15 11:22:23] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:22:23] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:22:23] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:22:23] INFO [app] 正在注册中间件
[2026-01-15 11:22:23] INFO [app] 注册中间件成功
[2026-01-15 11:22:23] INFO [app] 正在启动fastapi应用
[2026-01-15 11:22:23] INFO [app] 正在注册数据库
[2026-01-15 11:22:23] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:22:23] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:22:23] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:22:23] INFO [app] 注册数据库完成
[2026-01-15 11:22:23] INFO [app] 正在注册路由
[2026-01-15 11:22:23] INFO [app] 注册路由完成
[2026-01-15 11:22:34] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('6cea5e43-3c27-4f2c-b0d6-d78359d089cb'), '彭彦林', 'pyan83426@163.com', '$2b$12$5KPu7Sr/s8Ll2YHMufQTR.RCndp3p6FXi/jPq8UYrb8zPsshVAma2', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 22, 35, 454931), datetime.datetime(2026, 1, 15, 11, 22, 35, 454931))
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('6cea5e43-3c27-4f2c-b0d6-d78359d089cb'),)
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] [generated in 0.00040s] (UUID('0787399a-ffc7-433a-91fc-08c4b5643d2f'), UUID('6cea5e43-3c27-4f2c-b0d6-d78359d089cb'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 22, 35, 469151))
[2026-01-15 11:22:35] INFO [UserService] 用户活动已记录: register, user_id=6cea5e43-3c27-4f2c-b0d6-d78359d089cb
[2026-01-15 11:22:35] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:22:35] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:22:35] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:22:35] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000017F96122110>>
[2026-01-15 11:25:55] ERROR [app] fastapi应用关闭
[2026-01-15 11:25:55] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000017F96122110>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 11:26:01] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:26:01] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:26:01] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:26:01] INFO [app] 正在注册中间件
[2026-01-15 11:26:01] INFO [app] 注册中间件成功
[2026-01-15 11:26:01] INFO [app] 正在启动fastapi应用
[2026-01-15 11:26:01] INFO [app] 正在注册数据库
[2026-01-15 11:26:01] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:26:01] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:26:01] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:26:01] INFO [app] 注册数据库完成
[2026-01-15 11:26:01] INFO [app] 正在注册路由
[2026-01-15 11:26:01] INFO [app] 注册路由完成
[2026-01-15 11:26:23] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('d1e7fba7-2020-4d7a-8e08-d41f34d1b90d'), '彭彦林', 'pyan83426@163.com', '$2b$12$XfDwSF82X.C3VWdVjyulwuoFtabFy6WUyyIctgyNUVgqpfCo4Q1Ii', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 26, 23, 867146), datetime.datetime(2026, 1, 15, 11, 26, 23, 867682))
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] (UUID('d1e7fba7-2020-4d7a-8e08-d41f34d1b90d'),)
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('1bb16bbb-7130-4726-9339-8407a6f4ac0b'), UUID('d1e7fba7-2020-4d7a-8e08-d41f34d1b90d'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 26, 23, 873920))
[2026-01-15 11:26:23] INFO [UserService] 用户活动已记录: register, user_id=d1e7fba7-2020-4d7a-8e08-d41f34d1b90d
[2026-01-15 11:26:23] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:26:23] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:26:23] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:26:23] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001C805CB2110>>
[2026-01-15 11:32:29] ERROR [app] fastapi应用关闭
[2026-01-15 11:32:30] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001C805CB2110>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 11:32:39] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:32:39] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:32:39] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:32:39] INFO [app] 正在注册中间件
[2026-01-15 11:32:39] INFO [app] 注册中间件成功
[2026-01-15 11:32:39] INFO [app] 正在启动fastapi应用
[2026-01-15 11:32:39] INFO [app] 正在注册数据库
[2026-01-15 11:32:39] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:32:39] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:32:39] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:32:39] INFO [app] 注册数据库完成
[2026-01-15 11:32:39] INFO [app] 正在注册路由
[2026-01-15 11:32:39] INFO [app] 注册路由完成
[2026-01-15 11:32:42] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [generated in 0.00056s] ('pyan83426@163.com',)
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [generated in 0.00047s] (UUID('67fb83a8-2853-48ef-b94d-2679dc7307fb'), '彭彦林', 'pyan83426@163.com', '$2b$12$t1fEnyfRs1HCJCN0YSvcdu9O/rl4Y5Ni.MCchYuiYWEVsXNxAhE66', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 32, 43, 588889), datetime.datetime(2026, 1, 15, 11, 32, 43, 588889))
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [generated in 0.00037s] (UUID('67fb83a8-2853-48ef-b94d-2679dc7307fb'),)
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] [generated in 0.00048s] (UUID('2afcd259-dd78-4105-b8ae-9994251bf38b'), UUID('67fb83a8-2853-48ef-b94d-2679dc7307fb'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 32, 43, 594859))
[2026-01-15 11:32:43] INFO [UserService] 用户活动已记录: register, user_id=67fb83a8-2853-48ef-b94d-2679dc7307fb
[2026-01-15 11:32:43] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:32:43] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:32:43] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:32:43] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001D2A9013100>>
[2026-01-15 11:34:57] ERROR [app] fastapi应用关闭
[2026-01-15 11:35:05] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:35:05] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:35:05] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:35:05] INFO [app] 正在注册中间件
[2026-01-15 11:35:05] INFO [app] 注册中间件成功
[2026-01-15 11:35:05] INFO [app] 正在启动fastapi应用
[2026-01-15 11:35:05] INFO [app] 正在注册数据库
[2026-01-15 11:35:05] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:35:05] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:35:05] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:35:05] INFO [app] 注册数据库完成
[2026-01-15 11:35:05] INFO [app] 正在注册路由
[2026-01-15 11:35:05] INFO [app] 注册路由完成
[2026-01-15 11:35:09] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:35:09] INFO [sqlalchemy.engine.Engine] [generated in 0.00038s] ('pyan83426@163.com',)
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00046s] (UUID('038e366d-380c-42a2-b7a6-d0e2a618b907'), '彭彦林', 'pyan83426@163.com', '$2b$12$daZogucbCfpKErakLlDQ2uFgWD5AF3qK26/xUpzsFeYXULnlS/yFS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 35, 10, 81623), datetime.datetime(2026, 1, 15, 11, 35, 10, 81623))
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00037s] (UUID('038e366d-380c-42a2-b7a6-d0e2a618b907'),)
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] (UUID('9ca4f922-5e71-4cd5-9d58-dc9cfc3fc386'), UUID('038e366d-380c-42a2-b7a6-d0e2a618b907'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 35, 10, 91654))
[2026-01-15 11:35:10] INFO [UserService] 用户活动已记录: register, user_id=038e366d-380c-42a2-b7a6-d0e2a618b907
[2026-01-15 11:35:10] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:35:10] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:35:10] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:35:10] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000012DADCE6110>>
[2026-01-15 11:36:16] ERROR [app] fastapi应用关闭
[2026-01-15 11:36:24] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:36:24] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:36:24] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:36:24] INFO [app] 正在注册中间件
[2026-01-15 11:36:24] INFO [app] 注册中间件成功
[2026-01-15 11:36:24] INFO [app] 正在启动fastapi应用
[2026-01-15 11:36:24] INFO [app] 正在注册数据库
[2026-01-15 11:36:24] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:36:24] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:36:24] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:36:24] INFO [app] 注册数据库完成
[2026-01-15 11:36:24] INFO [app] 正在注册路由
[2026-01-15 11:36:24] INFO [app] 注册路由完成
[2026-01-15 11:36:38] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:36:38] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:36:38] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:36:38] INFO [app] 正在注册中间件
[2026-01-15 11:36:38] INFO [app] 注册中间件成功
[2026-01-15 11:36:38] INFO [app] 正在启动fastapi应用
[2026-01-15 11:36:38] INFO [app] 正在注册数据库
[2026-01-15 11:36:38] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:36:39] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:36:39] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:36:39] INFO [app] 注册数据库完成
[2026-01-15 11:36:39] INFO [app] 正在注册路由
[2026-01-15 11:36:39] INFO [app] 注册路由完成
[2026-01-15 11:36:41] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:36:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] ('pyan83426@163.com',)
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00088s] (UUID('f70a8af2-0d5e-405e-8302-c50976766e30'), '彭彦林', 'pyan83426@163.com', '$2b$12$mV2uYjlf6bxV1.W23SAeNuDlyQ4i1JDfxFoSNey/jfWN6ka1tcINS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 36, 42, 334001), datetime.datetime(2026, 1, 15, 11, 36, 42, 334001))
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00041s] (UUID('f70a8af2-0d5e-405e-8302-c50976766e30'),)
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] [generated in 0.00051s] (UUID('38be15df-4c19-444a-aed3-bcbe27471c18'), UUID('f70a8af2-0d5e-405e-8302-c50976766e30'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 36, 42, 345958))
[2026-01-15 11:36:42] INFO [UserService] 用户活动已记录: register, user_id=f70a8af2-0d5e-405e-8302-c50976766e30
[2026-01-15 11:36:42] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:36:42] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:36:42] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:36:42] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000021E66A06110>>
[2026-01-15 11:37:26] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] [cached since 45.05s ago] ('pyan83426@163.com',)
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] [cached since 45.05s ago] (UUID('2873e4b9-f754-46ca-a56c-1aac76f75783'), '彭彦林', 'pyan83426@163.com', '$2b$12$JpABv.BT3WsqaBLD2lOqre/c9Fl8LFzs2HqFpc1OiefoRbaPAw5vG', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 37, 27, 385671), datetime.datetime(2026, 1, 15, 11, 37, 27, 385671))
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] [cached since 45.05s ago] (UUID('2873e4b9-f754-46ca-a56c-1aac76f75783'),)
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] [cached since 45.04s ago] (UUID('dd6bf0c2-f6a9-4e07-8261-985fd64168ab'), UUID('2873e4b9-f754-46ca-a56c-1aac76f75783'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 37, 27, 390899))
[2026-01-15 11:37:27] INFO [UserService] 用户活动已记录: register, user_id=2873e4b9-f754-46ca-a56c-1aac76f75783
[2026-01-15 11:37:27] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:37:27] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:37:27] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:37:27] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000021E66EA7B50>>
[2026-01-15 11:37:48] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:37:48] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:37:48] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:37:48] INFO [app] 正在注册中间件
[2026-01-15 11:37:48] INFO [app] 注册中间件成功
[2026-01-15 11:37:48] INFO [app] 正在启动fastapi应用
[2026-01-15 11:37:48] INFO [app] 正在注册数据库
[2026-01-15 11:37:48] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:37:48] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:37:48] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:37:48] INFO [app] 注册数据库完成
[2026-01-15 11:37:48] INFO [app] 正在注册路由
[2026-01-15 11:37:48] INFO [app] 注册路由完成
[2026-01-15 11:37:50] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:37:56] INFO [sqlalchemy.engine.Engine] [generated in 0.00057s] ('pyan83426@163.com',)
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] [generated in 0.00117s] (UUID('5ac38faf-1980-4f89-b4f5-d86c734c4385'), '彭彦林', 'pyan83426@163.com', '$2b$12$QQDmCjY6NimEJkQmOAkwNu/idmrntKBFXPIgXgwKelcTwo7Jh9uIC', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 37, 57, 200112), datetime.datetime(2026, 1, 15, 11, 37, 57, 200707))
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] [generated in 0.00077s] (UUID('5ac38faf-1980-4f89-b4f5-d86c734c4385'),)
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] [generated in 0.00127s] (UUID('cc616a35-9e0a-48f2-b80b-96eb09f5171e'), UUID('5ac38faf-1980-4f89-b4f5-d86c734c4385'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 37, 57, 219301))
[2026-01-15 11:37:57] INFO [UserService] 用户活动已记录: register, user_id=5ac38faf-1980-4f89-b4f5-d86c734c4385
[2026-01-15 11:37:57] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:37:57] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:37:57] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:37:57] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000026E459A54E0>>
[2026-01-15 11:40:38] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:40:38] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:40:38] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:40:38] INFO [app] 正在注册中间件
[2026-01-15 11:40:38] INFO [app] 注册中间件成功
[2026-01-15 11:40:38] INFO [app] 正在启动fastapi应用
[2026-01-15 11:40:38] INFO [app] 正在注册数据库
[2026-01-15 11:40:38] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:40:38] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:40:38] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:40:38] INFO [app] 注册数据库完成
[2026-01-15 11:40:38] INFO [app] 正在注册路由
[2026-01-15 11:40:38] INFO [app] 注册路由完成
[2026-01-15 11:40:55] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:40:57] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00077s] ('pyan83426@163.com',)
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00085s] (UUID('fba626f8-079a-4c49-8e4c-7920c62e8901'), '彭彦林', 'pyan83426@163.com', '$2b$12$YG.SGqNFtv58mbgt6BlCQ.sjuvvz.IbkpENBR3yvz3luERF.vueFy', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 40, 58, 456204), datetime.datetime(2026, 1, 15, 11, 40, 58, 457222))
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:40:58] INFO [sqlalchemy.engine.Engine] [generated in 0.00047s] (UUID('fba626f8-079a-4c49-8e4c-7920c62e8901'),)
[2026-01-15 11:41:02] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:41:02] INFO [sqlalchemy.engine.Engine] [generated in 0.00135s] (UUID('b05dee6b-1e44-405c-aab8-7591178b7a3c'), UUID('fba626f8-079a-4c49-8e4c-7920c62e8901'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 41, 2, 757700))
[2026-01-15 11:41:02] INFO [UserService] 用户活动已记录: register, user_id=fba626f8-079a-4c49-8e4c-7920c62e8901
[2026-01-15 11:41:02] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:41:02] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:41:02] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:41:02] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000002644E471990>>
[2026-01-15 11:41:23] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:41:23] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:41:23] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:41:23] INFO [app] 正在注册中间件
[2026-01-15 11:41:23] INFO [app] 注册中间件成功
[2026-01-15 11:41:23] INFO [app] 正在启动fastapi应用
[2026-01-15 11:41:23] INFO [app] 正在注册数据库
[2026-01-15 11:41:23] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:41:23] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:41:23] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:41:23] INFO [app] 注册数据库完成
[2026-01-15 11:41:23] INFO [app] 正在注册路由
[2026-01-15 11:41:23] INFO [app] 注册路由完成
[2026-01-15 11:41:28] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [generated in 0.00057s] ('pyan83426@163.com',)
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [generated in 0.00075s] (UUID('98b98c22-331e-48e0-86ca-3641aa150e7b'), '彭彦林', 'pyan83426@163.com', '$2b$12$ERg21v5ueEq6uknUzfaUWuO68OU0OVHdnTpR20fHfkRKKvWi7nvZ.', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 41, 30, 705411), datetime.datetime(2026, 1, 15, 11, 41, 30, 705411))
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:41:30] INFO [sqlalchemy.engine.Engine] [generated in 0.00053s] (UUID('98b98c22-331e-48e0-86ca-3641aa150e7b'),)
[2026-01-15 11:41:35] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:41:37] INFO [sqlalchemy.engine.Engine] [generated in 2.36350s] (UUID('686803df-8902-455f-8a4e-039f6b51b588'), UUID('98b98c22-331e-48e0-86ca-3641aa150e7b'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 41, 34, 470912))
[2026-01-15 11:41:41] INFO [UserService] 用户活动已记录: register, user_id=98b98c22-331e-48e0-86ca-3641aa150e7b
[2026-01-15 11:41:42] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:41:55] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:43:47] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:43:50] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001D52AA9A5C0>>
[2026-01-15 11:59:25] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 11:59:25] INFO [app] 正在注册全局异常管理器
[2026-01-15 11:59:25] INFO [app] 注册全局异常管理器成功
[2026-01-15 11:59:25] INFO [app] 正在注册中间件
[2026-01-15 11:59:25] INFO [app] 注册中间件成功
[2026-01-15 11:59:25] INFO [app] 正在启动fastapi应用
[2026-01-15 11:59:25] INFO [app] 正在注册数据库
[2026-01-15 11:59:25] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 11:59:25] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 11:59:25] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 11:59:25] INFO [app] 注册数据库完成
[2026-01-15 11:59:25] INFO [app] 正在注册路由
[2026-01-15 11:59:25] INFO [app] 注册路由完成
[2026-01-15 11:59:27] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 11:59:27] INFO [sqlalchemy.engine.Engine] [generated in 0.00039s] ('pyan83426@163.com',)
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('4186cf58-6765-4f1d-a043-82be27693010'), '彭彦林', 'pyan83426@163.com', '$2b$12$bLhjblyodxRdUd7HhRdr1.GA6AKwkc2LwJ9Mjr.FXl71kjxZiK14i', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 11, 59, 28, 50068), datetime.datetime(2026, 1, 15, 11, 59, 28, 50068))
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('4186cf58-6765-4f1d-a043-82be27693010'),)
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] [generated in 0.00034s] (UUID('6724d255-941b-453b-8799-e7712afd93ce'), UUID('4186cf58-6765-4f1d-a043-82be27693010'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 11, 59, 28, 58535))
[2026-01-15 11:59:28] INFO [UserService] 用户活动已记录: register, user_id=4186cf58-6765-4f1d-a043-82be27693010
[2026-01-15 11:59:28] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 11:59:28] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 11:59:28] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 11:59:28] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x000001D1DFDC3100>>
[2026-01-15 12:06:55] ERROR [app] fastapi应用关闭
[2026-01-15 12:07:03] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:07:03] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:07:03] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:07:03] INFO [app] 正在注册中间件
[2026-01-15 12:07:03] INFO [app] 注册中间件成功
[2026-01-15 12:07:03] INFO [app] 正在启动fastapi应用
[2026-01-15 12:07:03] INFO [app] 正在注册数据库
[2026-01-15 12:07:03] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:07:03] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:07:03] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:07:03] INFO [app] 注册数据库完成
[2026-01-15 12:07:03] INFO [app] 正在注册路由
[2026-01-15 12:07:03] INFO [app] 注册路由完成
[2026-01-15 12:07:11] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:07:11] INFO [sqlalchemy.engine.Engine] [generated in 0.00057s] ('pyan83426@163.com',)
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00045s] (UUID('eb08f855-7769-4ec3-b010-f4774a220790'), '彭彦林', 'pyan83426@163.com', '$2b$12$NxoI4eno4TY7rBSjWqmPsuBe6UVNJ0R02H1osMKecKHL9PNcNiO.2', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 12, 7, 12, 195194), datetime.datetime(2026, 1, 15, 12, 7, 12, 195194))
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00027s] (UUID('eb08f855-7769-4ec3-b010-f4774a220790'),)
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('16ac164e-13a5-4a36-8d75-46e2e1391773'), UUID('eb08f855-7769-4ec3-b010-f4774a220790'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 12, 7, 12, 203568))
[2026-01-15 12:07:12] INFO [UserService] 用户活动已记录: register, user_id=eb08f855-7769-4ec3-b010-f4774a220790
[2026-01-15 12:07:12] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 12:07:12] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 12:07:12] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:07:12] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F7F2C6110>>
[2026-01-15 12:11:55] ERROR [app] fastapi应用关闭
[2026-01-15 12:11:55] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F7F2C6110>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
[2026-01-15 12:12:02] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:12:02] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:12:02] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:12:02] INFO [app] 正在注册中间件
[2026-01-15 12:12:02] INFO [app] 注册中间件成功
[2026-01-15 12:12:02] INFO [app] 正在启动fastapi应用
[2026-01-15 12:12:02] INFO [app] 正在注册数据库
[2026-01-15 12:12:02] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:12:03] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:12:03] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:12:03] INFO [app] 注册数据库完成
[2026-01-15 12:12:03] INFO [app] 正在注册路由
[2026-01-15 12:12:03] INFO [app] 注册路由完成
[2026-01-15 12:16:55] ERROR [app] fastapi应用关闭
[2026-01-15 12:17:04] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:17:04] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:17:04] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:17:04] INFO [app] 正在注册中间件
[2026-01-15 12:17:04] INFO [app] 注册中间件成功
[2026-01-15 12:17:04] INFO [app] 正在启动fastapi应用
[2026-01-15 12:17:04] INFO [app] 正在注册数据库
[2026-01-15 12:17:04] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:17:04] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:17:04] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:17:04] INFO [app] 注册数据库完成
[2026-01-15 12:17:04] INFO [app] 正在注册路由
[2026-01-15 12:17:04] INFO [app] 注册路由完成
[2026-01-15 12:32:50] ERROR [app] fastapi应用关闭
[2026-01-15 12:32:59] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:32:59] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:32:59] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:32:59] INFO [app] 正在注册中间件
[2026-01-15 12:32:59] INFO [app] 注册中间件成功
[2026-01-15 12:32:59] INFO [app] 正在启动fastapi应用
[2026-01-15 12:32:59] INFO [app] 正在注册数据库
[2026-01-15 12:32:59] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:32:59] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:32:59] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:32:59] INFO [app] 注册数据库完成
[2026-01-15 12:32:59] INFO [app] 正在注册路由
[2026-01-15 12:32:59] INFO [app] 注册路由完成
[2026-01-15 12:33:03] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:33:03] INFO [sqlalchemy.engine.Engine] [generated in 0.00057s] ('pyan83426@163.com',)
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] (UUID('0b530e5d-5b0d-4c6e-8d80-a9f1b6a641fa'), '彭彦林', 'pyan83426@163.com', '$2b$12$oCbl47n8ZNPzEBHYz4yhMeMYrs5Rd.oCvm3xbX9ANXEF3NE17R3Xe', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 12, 33, 4, 106888), datetime.datetime(2026, 1, 15, 12, 33, 4, 106888))
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00035s] (UUID('0b530e5d-5b0d-4c6e-8d80-a9f1b6a641fa'),)
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] [generated in 0.00043s] (UUID('60233258-2044-4727-a099-54c717c55d64'), UUID('0b530e5d-5b0d-4c6e-8d80-a9f1b6a641fa'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 12, 33, 4, 117470))
[2026-01-15 12:33:04] INFO [UserService] 用户活动已记录: register, user_id=0b530e5d-5b0d-4c6e-8d80-a9f1b6a641fa
[2026-01-15 12:33:04] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 12:33:04] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 12:33:04] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:33:04] ERROR [sqlalchemy.pool.impl.AsyncAdaptedQueuePool] Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000021389721A80>>
[2026-01-15 12:36:37] ERROR [app] fastapi应用关闭
[2026-01-15 12:36:46] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:36:46] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:36:46] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:36:46] INFO [app] 正在注册中间件
[2026-01-15 12:36:46] INFO [app] 注册中间件成功
[2026-01-15 12:36:46] INFO [app] 正在启动fastapi应用
[2026-01-15 12:36:46] INFO [app] 正在注册数据库
[2026-01-15 12:36:46] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:36:46] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:36:46] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:36:46] INFO [app] 注册数据库完成
[2026-01-15 12:36:46] INFO [app] 正在注册路由
[2026-01-15 12:36:46] INFO [app] 注册路由完成
[2026-01-15 12:37:12] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] ('pyan83426@163.com',)
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00042s] (UUID('11e6c857-1199-4966-9df8-519393ff9176'), '彭彦林', 'pyan83426@163.com', '$2b$12$76TjOiLA2aXUOxItnxfCPefkc.q8SiWmSBUpm0iINxAZ0aONdk/lS', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 12, 37, 12, 955160), datetime.datetime(2026, 1, 15, 12, 37, 12, 955160))
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00031s] (UUID('11e6c857-1199-4966-9df8-519393ff9176'),)
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00033s] (UUID('6e5ea038-e351-4131-8cf9-f604844ad6e8'), UUID('11e6c857-1199-4966-9df8-519393ff9176'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 12, 37, 12, 965255))
[2026-01-15 12:37:12] INFO [UserService] 用户活动已记录: register, user_id=11e6c857-1199-4966-9df8-519393ff9176
[2026-01-15 12:37:12] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 12:37:12] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 12:37:12] INFO [app] 请求处理完成: POST /api/v1/users/register
[2026-01-15 12:37:12] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 12:38:23] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:23] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:23] INFO [sqlalchemy.engine.Engine] [cached since 70.56s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:23] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:23] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:23] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:23] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:23] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:38:33] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:33] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:33] INFO [sqlalchemy.engine.Engine] [cached since 81.23s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:34] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:34] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:34] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:34] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:34] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:38:40] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:40] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:40] INFO [sqlalchemy.engine.Engine] [cached since 88.11s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:41] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:41] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:41] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:41] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:41] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:38:46] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:46] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:46] INFO [sqlalchemy.engine.Engine] [cached since 94.35s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:47] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:47] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:47] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:47] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:47] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:38:53] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:53] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:53] INFO [sqlalchemy.engine.Engine] [cached since 100.4s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:53] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:53] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:53] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:53] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:53] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:38:56] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:56] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:56] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:56] INFO [sqlalchemy.engine.Engine] [cached since 103.7s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:56] INFO [auth] Password verification successful
[2026-01-15 12:38:56] ERROR [auth] Failed to create access token for user 11e6c857-1199-4966-9df8-519393ff9176: module 'jwt' has no attribute 'encode'
[2026-01-15 12:38:56] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:56] ERROR [sql] ❌ 数据库事务失败: module 'jwt' has no attribute 'encode'
[2026-01-15 12:38:56] CRITICAL [app] 未处理的异常: module 'jwt' has no attribute 'encode'
[2026-01-15 12:38:59] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 12:38:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 12:38:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 12:38:59] INFO [sqlalchemy.engine.Engine] [cached since 106.7s ago] ('pyan83426@163.com',)
[2026-01-15 12:38:59] WARNING [auth] Password verification failed: invalid password
[2026-01-15 12:38:59] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 12:38:59] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 12:38:59] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 12:38:59] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 12:40:48] ERROR [app] fastapi应用关闭
[2026-01-15 12:40:57] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:40:57] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:40:57] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:40:57] INFO [app] 正在注册中间件
[2026-01-15 12:40:57] INFO [app] 注册中间件成功
[2026-01-15 12:40:57] INFO [app] 正在启动fastapi应用
[2026-01-15 12:40:57] INFO [app] 正在注册数据库
[2026-01-15 12:40:57] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:40:57] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:40:57] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:40:57] INFO [app] 注册数据库完成
[2026-01-15 12:40:57] INFO [app] 正在注册路由
[2026-01-15 12:40:57] INFO [app] 注册路由完成
[2026-01-15 12:41:38] ERROR [app] fastapi应用关闭
[2026-01-15 12:41:46] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:41:46] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:41:46] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:41:46] INFO [app] 正在注册中间件
[2026-01-15 12:41:46] INFO [app] 注册中间件成功
[2026-01-15 12:41:46] INFO [app] 正在启动fastapi应用
[2026-01-15 12:41:46] INFO [app] 正在注册数据库
[2026-01-15 12:41:46] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:41:46] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:41:46] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:41:46] INFO [app] 注册数据库完成
[2026-01-15 12:41:46] INFO [app] 正在注册路由
[2026-01-15 12:41:46] INFO [app] 注册路由完成
[2026-01-15 12:46:38] ERROR [app] fastapi应用关闭
[2026-01-15 12:46:46] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:46:46] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:46:46] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:46:46] INFO [app] 正在注册中间件
[2026-01-15 12:46:46] INFO [app] 注册中间件成功
[2026-01-15 12:46:46] INFO [app] 正在启动fastapi应用
[2026-01-15 12:46:46] INFO [app] 正在注册数据库
[2026-01-15 12:46:46] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:46:46] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:46:46] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:46:46] INFO [app] 注册数据库完成
[2026-01-15 12:46:46] INFO [app] 正在注册路由
[2026-01-15 12:46:46] INFO [app] 注册路由完成
[2026-01-15 12:51:38] ERROR [app] fastapi应用关闭
[2026-01-15 12:59:26] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 12:59:26] INFO [app] 正在注册全局异常管理器
[2026-01-15 12:59:26] INFO [app] 注册全局异常管理器成功
[2026-01-15 12:59:26] INFO [app] 正在注册中间件
[2026-01-15 12:59:26] INFO [app] 注册中间件成功
[2026-01-15 12:59:26] INFO [app] 正在启动fastapi应用
[2026-01-15 12:59:26] INFO [app] 正在注册数据库
[2026-01-15 12:59:26] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 12:59:26] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 12:59:26] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 12:59:26] INFO [app] 注册数据库完成
[2026-01-15 12:59:26] INFO [app] 正在注册路由
[2026-01-15 12:59:26] INFO [app] 注册路由完成
[2026-01-15 13:04:17] ERROR [app] fastapi应用关闭
[2026-01-15 13:04:27] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 13:04:27] INFO [app] 正在注册全局异常管理器
[2026-01-15 13:04:27] INFO [app] 注册全局异常管理器成功
[2026-01-15 13:04:27] INFO [app] 正在注册中间件
[2026-01-15 13:04:27] INFO [app] 注册中间件成功
[2026-01-15 13:04:27] INFO [app] 正在启动fastapi应用
[2026-01-15 13:04:27] INFO [app] 正在注册数据库
[2026-01-15 13:04:27] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 13:04:27] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 13:04:27] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 13:04:27] INFO [app] 注册数据库完成
[2026-01-15 13:04:27] INFO [app] 正在注册路由
[2026-01-15 13:04:27] INFO [app] 注册路由完成
[2026-01-15 13:44:48] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 13:44:48] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] ('pyan83426@163.com',)
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] [generated in 0.00061s] (UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), '彭彦林', 'pyan83426@163.com', '$2b$12$S/BsXNrda0Ra9N4q8fTMbecBli4GIPQpKEtza7BiUS.By0QIOOC/a', 'patient', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 13, 44, 49, 202509), datetime.datetime(2026, 1, 15, 13, 44, 49, 202509))
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] [generated in 0.00026s] (UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'),)
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] [generated in 0.00047s] (UUID('c7451147-ded7-4958-ada3-ce2d896f7cd5'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 13, 44, 49, 228096))
[2026-01-15 13:44:49] INFO [UserService] 用户活动已记录: register, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 13:44:49] INFO [UserService] 用户注册成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 13:44:49] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 13:44:49] INFO [app] 请求处理完成: POST /api/v1/users/register
[2026-01-15 13:44:49] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 13:45:01] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] [cached since 12.41s ago] ('pyan83426@163.com',)
[2026-01-15 13:45:01] INFO [auth] Password verification successful
[2026-01-15 13:45:01] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 05:45:01.600217+00:00
[2026-01-15 13:45:01] INFO [auth] Created refresh token: y7TvPoVn...
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00045s] (UUID('795ef35d-512c-4c64-a095-01e9f4fe0a85'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '6365bf08e45958f07b1aa477653586cd36a7ef6cd5b1aa22be4168919d638863', datetime.datetime(2026, 2, 14, 13, 45, 1, 601245), datetime.datetime(2026, 1, 15, 13, 45, 1, 604253), False)
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] INSERT INTO user_states (app_name, user_id, state, update_time) VALUES ($1::VARCHAR, $2::UUID, $3::JSON, $4::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] [generated in 0.00039s] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), '{"last_login": "2026-01-15T13:45:01.609517", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 13, 45, 1, 618727))
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] [cached since 12.39s ago] (UUID('ce4b38a7-c15a-4469-b90c-daef14154aa4'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 13, 45, 1, 622516))
[2026-01-15 13:45:01] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 13:45:01] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 13:45:01] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 13:45:01] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 13:45:01] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 13:46:46] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] [cached since 117.3s ago] ('pyan83426@163.com',)
[2026-01-15 13:46:46] INFO [auth] Password verification successful
[2026-01-15 13:46:46] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 05:46:46.553475+00:00
[2026-01-15 13:46:46] INFO [auth] Created refresh token: dQC9WLOY...
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] [cached since 105s ago] (UUID('812be900-ecc3-4089-9b3e-603289da8e50'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '4080260f1a6e200b263c1e52afce916d3189fb0fcaafc266e61372a4b6bec2b4', datetime.datetime(2026, 2, 14, 13, 46, 46, 553475), datetime.datetime(2026, 1, 15, 13, 46, 46, 554475), False)
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] [cached since 104.9s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] [generated in 0.00036s] ('{"last_login": "2026-01-15T13:46:46.555475", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 13, 46, 46, 559849), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] [cached since 117.3s ago] (UUID('6e143156-e791-4d8e-8098-1b7cbeb6fc34'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 13, 46, 46, 563851))
[2026-01-15 13:46:46] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 13:46:46] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 13:46:46] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 13:46:46] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 13:46:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 13:47:05] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] [cached since 136.2s ago] ('pyan83426@163.com',)
[2026-01-15 13:47:05] INFO [auth] Password verification successful
[2026-01-15 13:47:05] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 05:47:05.395795+00:00
[2026-01-15 13:47:05] INFO [auth] Created refresh token: hEkS2wKj...
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] [cached since 123.8s ago] (UUID('bbca0cfc-5c28-48ab-a88c-879a093ccac1'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '5905fad7b635f004ee5608d587a2fdd4f4e0a7156abd2ec2353a427fdbe7b39f', datetime.datetime(2026, 2, 14, 13, 47, 5, 396797), datetime.datetime(2026, 1, 15, 13, 47, 5, 396797), False)
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] [cached since 123.8s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] [cached since 18.84s ago] ('{"last_login": "2026-01-15T13:47:05.398992", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 13, 47, 5, 402321), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] [cached since 136.2s ago] (UUID('f89f574f-652c-42ff-be42-5014bac68bc9'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 13, 47, 5, 405937))
[2026-01-15 13:47:05] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 13:47:05] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 13:47:05] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 13:47:05] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 13:47:05] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:21:47] ERROR [app] fastapi应用关闭
[2026-01-15 15:22:02] INFO [app] 创建 FastAPI 应用实例
[2026-01-15 15:22:02] INFO [app] 正在注册全局异常管理器
[2026-01-15 15:22:02] INFO [app] 注册全局异常管理器成功
[2026-01-15 15:22:02] INFO [app] 正在注册中间件
[2026-01-15 15:22:02] INFO [app] 注册中间件成功
[2026-01-15 15:22:02] INFO [app] 正在启动fastapi应用
[2026-01-15 15:22:02] INFO [app] 正在注册数据库
[2026-01-15 15:22:02] INFO [sql] ----------初始化异步数据库配置----------------!
[2026-01-15 15:22:02] INFO [sql] --------------PostgreSQL异步引擎创建成功----------------
[2026-01-15 15:22:02] INFO [sql] ---------------异步会话工厂创建成功----------------
[2026-01-15 15:22:02] INFO [app] 注册数据库完成
[2026-01-15 15:22:02] INFO [app] 正在注册路由
[2026-01-15 15:22:02] INFO [app] 注册路由完成
[2026-01-15 15:41:12] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] select pg_catalog.version()
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] select current_schema()
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] show standard_conforming_strings
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] [raw sql] ()
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:41:12] INFO [sqlalchemy.engine.Engine] [generated in 0.00058s] ('pyan83426@163.com',)
[2026-01-15 15:41:13] INFO [auth] Password verification successful
[2026-01-15 15:41:13] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:41:13.130473+00:00
[2026-01-15 15:41:13] INFO [auth] Created refresh token: 7sxp0395...
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00105s] (UUID('fb0165f4-c33e-43f0-91e1-352e94103689'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '518e7f3a9473fab0a5c835fd4d51f509e3af01dfc0890e2bec25fef8e4a72613', datetime.datetime(2026, 2, 14, 15, 41, 13, 132534), datetime.datetime(2026, 1, 15, 15, 41, 13, 137016), False)
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00049s] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00055s] ('{"last_login": "2026-01-15T15:41:13.142911", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 41, 13, 149950), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] [generated in 0.00071s] (UUID('08dd09d3-b786-43fd-9885-c70f19a90113'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 41, 13, 156473))
[2026-01-15 15:41:13] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:41:13] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:41:13] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:41:13] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:41:13] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:41:32] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] [cached since 19.26s ago] ('pyan83426@163.com',)
[2026-01-15 15:41:32] INFO [auth] Password verification successful
[2026-01-15 15:41:32] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:41:32.396460+00:00
[2026-01-15 15:41:32] INFO [auth] Created refresh token: L8HOf8VX...
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] [cached since 19.26s ago] (UUID('06449de5-0943-458f-9118-c422d57cdd0b'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '67aac0c59e256027ae5cc178936ecb84986b9a604907b0ef6362adf70e36afd2', datetime.datetime(2026, 2, 14, 15, 41, 32, 397466), datetime.datetime(2026, 1, 15, 15, 41, 32, 398471), False)
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] [cached since 19.26s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] [cached since 19.25s ago] ('{"last_login": "2026-01-15T15:41:32.401488", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 41, 32, 405506), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] [cached since 19.25s ago] (UUID('028fadd4-fff3-4f34-8141-3d65105009e7'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 41, 32, 410131))
[2026-01-15 15:41:32] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:41:32] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:41:32] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:41:32] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:41:32] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:46:06] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:46:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:46:06] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:46:06] INFO [sqlalchemy.engine.Engine] [cached since 293.9s ago] ('pyan83426@163.com',)
[2026-01-15 15:46:07] INFO [auth] Password verification successful
[2026-01-15 15:46:07] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:46:07.060075+00:00
[2026-01-15 15:46:07] INFO [auth] Created refresh token: USMk0uBx...
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] [cached since 293.9s ago] (UUID('4328885b-0e98-4d33-b644-def7f78b886f'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '79897332a38ea3273e44066b210f256b2f9b73ccc832b64e8f3a052e587adbf7', datetime.datetime(2026, 2, 14, 15, 46, 7, 60075), datetime.datetime(2026, 1, 15, 15, 46, 7, 61082), False)
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] [cached since 293.9s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] [cached since 293.9s ago] ('{"last_login": "2026-01-15T15:46:07.064112", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 46, 7, 67710), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] [cached since 293.9s ago] (UUID('a6425776-df91-4261-822c-99d33fb05df7'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 46, 7, 70804))
[2026-01-15 15:46:07] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:46:07] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:46:07] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:46:07] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:46:07] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:46:42] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] [cached since 329.7s ago] ('pyan83426@163.com',)
[2026-01-15 15:46:42] INFO [auth] Password verification successful
[2026-01-15 15:46:42] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:46:42.826090+00:00
[2026-01-15 15:46:42] INFO [auth] Created refresh token: AeMZUA6A...
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] [cached since 329.7s ago] (UUID('f311f59e-c874-48e4-804b-7dac6a41b739'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '337fa7acb9cfa9bd02c5813266aa369db96c3c9b6e5ad1d2c5bd15ed59973ad3', datetime.datetime(2026, 2, 14, 15, 46, 42, 827098), datetime.datetime(2026, 1, 15, 15, 46, 42, 828098), False)
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] [cached since 329.7s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] [cached since 329.7s ago] ('{"last_login": "2026-01-15T15:46:42.831137", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 46, 42, 834375), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] [cached since 329.7s ago] (UUID('d6d75499-63b3-4840-ab65-0d946449ecf4'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 46, 42, 836380))
[2026-01-15 15:46:42] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:46:42] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:46:42] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:46:42] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:46:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:48:13] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:48:13] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:48:13] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:48:13] INFO [sqlalchemy.engine.Engine] [cached since 420.9s ago] ('pyan83426@163.com',)
[2026-01-15 15:48:14] INFO [auth] Password verification successful
[2026-01-15 15:48:14] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:48:14.055573+00:00
[2026-01-15 15:48:14] INFO [auth] Created refresh token: RHBMvFI2...
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] [cached since 420.9s ago] (UUID('c805ecd9-cc72-45c6-8629-5bcac189f636'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'ce849c4a07d719a5b6bc1293f5f24fb0482ffd76539af18c4bd103d1f1d4f2e1', datetime.datetime(2026, 2, 14, 15, 48, 14, 56580), datetime.datetime(2026, 1, 15, 15, 48, 14, 58647), False)
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] [cached since 420.9s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] [cached since 420.9s ago] ('{"last_login": "2026-01-15T15:48:14.074652", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 48, 14, 77165), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] [cached since 420.9s ago] (UUID('5090decb-9d3e-4006-a814-819b3448fde9'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 48, 14, 79641))
[2026-01-15 15:48:14] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:48:14] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:48:14] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:48:14] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:48:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:48:42] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] [cached since 449.4s ago] ('pyan83426@163.com',)
[2026-01-15 15:48:42] INFO [auth] Password verification successful
[2026-01-15 15:48:42] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:48:42.509483+00:00
[2026-01-15 15:48:42] INFO [auth] Created refresh token: ss6Bdqcb...
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] [cached since 449.4s ago] (UUID('a1c7f791-896c-4f33-86a9-d220d7d340e3'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '3c2bf1279733bfd4ec7427d51cfecfb48400c9c4aebfaf197c359d5eff80af25', datetime.datetime(2026, 2, 14, 15, 48, 42, 510987), datetime.datetime(2026, 1, 15, 15, 48, 42, 512071), False)
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] [cached since 449.4s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] [cached since 449.4s ago] ('{"last_login": "2026-01-15T15:48:42.514090", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 48, 42, 517029), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] [cached since 449.4s ago] (UUID('cf1eecc6-0231-4491-b730-f63c59ebd813'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 48, 42, 520083))
[2026-01-15 15:48:42] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:48:42] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:48:42] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:48:42] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:48:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:50:36] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] [cached since 563.4s ago] ('pyan83426@163.com',)
[2026-01-15 15:50:36] INFO [auth] Password verification successful
[2026-01-15 15:50:36] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:50:36.579194+00:00
[2026-01-15 15:50:36] INFO [auth] Created refresh token: EAcc9ucn...
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] [cached since 563.4s ago] (UUID('da6e986b-53f3-4a0e-b451-d0f87a4b9324'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '0c69f31c1818ce7d7b7afe84f601fb2395aa0b35144509b6e51d3d6585baf838', datetime.datetime(2026, 2, 14, 15, 50, 36, 580240), datetime.datetime(2026, 1, 15, 15, 50, 36, 582276), False)
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] [cached since 563.4s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] [cached since 563.4s ago] ('{"last_login": "2026-01-15T15:50:36.585489", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 50, 36, 588203), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] [cached since 563.4s ago] (UUID('2f61b8f9-a9f5-44d2-9496-7c176e8e6f18'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 50, 36, 591416))
[2026-01-15 15:50:36] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:50:36] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:50:36] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:50:36] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:50:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:32] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:56:32] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:32] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:56:32] INFO [sqlalchemy.engine.Engine] [cached since 920.2s ago] ('pyan83426@163.com',)
[2026-01-15 15:56:33] INFO [auth] Password verification successful
[2026-01-15 15:56:33] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:56:33.306059+00:00
[2026-01-15 15:56:33] INFO [auth] Created refresh token: AOCwQ5ns...
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [cached since 920.2s ago] (UUID('9262622d-5090-4eea-989b-1e6e6334f58a'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '73016acfd8b8a2354bbab065ed69a47f1d0980c1feba954e06d50cdbe912aa0a', datetime.datetime(2026, 2, 14, 15, 56, 33, 307480), datetime.datetime(2026, 1, 15, 15, 56, 33, 308507), False)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [cached since 920.2s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [cached since 920.2s ago] ('{"last_login": "2026-01-15T15:56:33.311509", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 56, 33, 315510), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [cached since 920.2s ago] (UUID('95f24268-30d8-4185-aaad-98d7e344768b'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 56, 33, 319514))
[2026-01-15 15:56:33] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:33] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:56:33] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:56:33] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:33] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00059s] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] [generated in 0.00050s] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:33] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 15:56:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:44] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] [cached since 11.17s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:44] INFO [user_controller] 开始用户登出
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] [generated in 0.00066s] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] [cached since 931.4s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] [cached since 931.4s ago] ('{"status": "offline", "logout_time": "2026-01-15T15:56:44.549079", "last_activity": "2026-01-15T15:56:44.549079"}', datetime.datetime(2026, 1, 15, 15, 56, 44, 551066), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] [cached since 931.4s ago] (UUID('a25e31f5-efd9-452e-b0e4-5b311d586c83'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 56, 44, 555780))
[2026-01-15 15:56:44] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:44] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:44] INFO [user_controller] 用户登出成功
[2026-01-15 15:56:44] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 15:56:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:59] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 946.3s ago] ('pyan83426@163.com',)
[2026-01-15 15:56:59] INFO [auth] Password verification successful
[2026-01-15 15:56:59] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:56:59.442738+00:00
[2026-01-15 15:56:59] INFO [auth] Created refresh token: EDHvk_jO...
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 946.3s ago] (UUID('07daffb1-ac60-430e-88b6-653b856e24db'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '3753704e918fdcc7ad5048b13dce0aabe26a8ba33c8066bed16cab98b77171ba', datetime.datetime(2026, 2, 14, 15, 56, 59, 443746), datetime.datetime(2026, 1, 15, 15, 56, 59, 444751), False)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 946.3s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 946.3s ago] ('{"last_login": "2026-01-15T15:56:59.448454", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 56, 59, 452570), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 946.3s ago] (UUID('4fe7bd19-114f-4854-909d-95d9bbfce949'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 56, 59, 456450))
[2026-01-15 15:56:59] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:59] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:56:59] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:56:59] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:59] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 26.12s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] [cached since 26.11s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:56:59] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 15:56:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:57:16] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] [cached since 43.22s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:57:16] INFO [user_controller] 开始用户登出
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] [cached since 32.04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] [cached since 963.4s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] [cached since 963.4s ago] ('{"status": "offline", "logout_time": "2026-01-15T15:57:16.591224", "last_activity": "2026-01-15T15:57:16.591224"}', datetime.datetime(2026, 1, 15, 15, 57, 16, 594298), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] [cached since 963.4s ago] (UUID('3a4d5b9f-1896-4a4e-8381-d906cef9ab63'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 57, 16, 598477))
[2026-01-15 15:57:16] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:57:16] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:57:16] INFO [user_controller] 用户登出成功
[2026-01-15 15:57:16] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 15:57:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:58:38] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 1045s ago] ('pyan83426@163.com',)
[2026-01-15 15:58:38] INFO [auth] Password verification successful
[2026-01-15 15:58:38] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 07:58:38.347277+00:00
[2026-01-15 15:58:38] INFO [auth] Created refresh token: jE4SsxFw...
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 1045s ago] (UUID('8c965166-f5b1-477e-986f-afbff0b300c0'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '007a02ec45fe02c83df3c344be30430cfd2b177784674a485a8572c72e7585c7', datetime.datetime(2026, 2, 14, 15, 58, 38, 348783), datetime.datetime(2026, 1, 15, 15, 58, 38, 349179), False)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 1045s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 1045s ago] ('{"last_login": "2026-01-15T15:58:38.354301", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 15, 58, 38, 357898), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 1045s ago] (UUID('be494af6-2772-4f18-89b7-d04fbfeb4566'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 58, 38, 360940))
[2026-01-15 15:58:38] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:58:38] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 15:58:38] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 15:58:38] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:58:38] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 125.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] [cached since 125.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:58:38] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 15:58:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:58:46] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] [cached since 133.3s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 15:58:46] INFO [user_controller] 开始用户登出
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] [cached since 122.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] [cached since 1054s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] [cached since 1054s ago] ('{"status": "offline", "logout_time": "2026-01-15T15:58:46.703076", "last_activity": "2026-01-15T15:58:46.703076"}', datetime.datetime(2026, 1, 15, 15, 58, 46, 705121), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] [cached since 1054s ago] (UUID('1b099269-98ad-4a42-908a-ff6f58ebb7e5'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 15, 58, 46, 709148))
[2026-01-15 15:58:46] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:58:46] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 15:58:46] INFO [user_controller] 用户登出成功
[2026-01-15 15:58:46] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 15:58:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:19] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 1627s ago] ('pyan83426@163.com',)
[2026-01-15 16:08:19] INFO [auth] Password verification successful
[2026-01-15 16:08:19] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:08:19.877540+00:00
[2026-01-15 16:08:19] INFO [auth] Created refresh token: 90oXDAeM...
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 1627s ago] (UUID('bd3e4fe1-660d-4cee-a788-86f63e84d3ef'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '399d6197f4c965392c68efc20f38bca10bce55161c713f6ea76f09cae745f1fc', datetime.datetime(2026, 2, 14, 16, 8, 19, 878672), datetime.datetime(2026, 1, 15, 16, 8, 19, 879748), False)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 1627s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 1627s ago] ('{"last_login": "2026-01-15T16:08:19.884951", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 8, 19, 889449), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 1627s ago] (UUID('304491d8-f2ca-4dd3-9ea6-1330b0b15068'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 8, 19, 894518))
[2026-01-15 16:08:19] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:19] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:08:19] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:08:19] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:19] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 706.6s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] [cached since 706.6s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:19] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:08:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:22] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] [cached since 709.4s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:22] INFO [user_controller] 开始用户登出
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] [cached since 698.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] [cached since 1630s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] [cached since 1630s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:08:22.745646", "last_activity": "2026-01-15T16:08:22.745646"}', datetime.datetime(2026, 1, 15, 16, 8, 22, 749262), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] [cached since 1630s ago] (UUID('e25e2810-853d-4ce7-86c6-e624114ba058'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 8, 22, 752734))
[2026-01-15 16:08:22] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:22] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:22] INFO [user_controller] 用户登出成功
[2026-01-15 16:08:22] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:08:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:39] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:08:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:39] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:08:39] INFO [sqlalchemy.engine.Engine] [cached since 1647s ago] ('pyan83426@163.com',)
[2026-01-15 16:08:40] INFO [auth] Password verification successful
[2026-01-15 16:08:40] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:08:40.131799+00:00
[2026-01-15 16:08:40] INFO [auth] Created refresh token: 4l-EtIDz...
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1647s ago] (UUID('a83f0654-01db-4929-a12b-a9c4f07ad56d'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '38133a54f92bf6d4eff7c338c9a1b8aeb4deb43a6f2d9a551e0fdb0523544680', datetime.datetime(2026, 2, 14, 16, 8, 40, 132545), datetime.datetime(2026, 1, 15, 16, 8, 40, 133635), False)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1647s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1647s ago] ('{"last_login": "2026-01-15T16:08:40.137091", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 8, 40, 140569), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1647s ago] (UUID('4fcd836e-eb98-4b8d-93ff-254457df963a'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 8, 40, 143625))
[2026-01-15 16:08:40] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:40] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:08:40] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:08:40] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:40] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 726.8s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] [cached since 726.8s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:08:40] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:10:46] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] [cached since 852.7s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:10:46] INFO [user_controller] 开始用户登出
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] [cached since 841.6s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] [cached since 1773s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] [cached since 1773s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:10:46.113310", "last_activity": "2026-01-15T16:10:46.113310"}', datetime.datetime(2026, 1, 15, 16, 10, 46, 116720), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] [cached since 1773s ago] (UUID('d9057300-3ca1-405d-a392-415cbd5ef798'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 10, 46, 120833))
[2026-01-15 16:10:46] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:10:46] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:10:46] INFO [user_controller] 用户登出成功
[2026-01-15 16:10:46] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:10:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:10:52] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 1779s ago] ('pyan83426@163.com',)
[2026-01-15 16:10:52] INFO [auth] Password verification successful
[2026-01-15 16:10:52] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:10:52.493908+00:00
[2026-01-15 16:10:52] INFO [auth] Created refresh token: vdjnZC-T...
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 1779s ago] (UUID('917d3c74-d8aa-4f37-abd2-e173750c1ce8'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '334cd525daecdfcb95af07d9efff6cd2c6e97581bfded8d39b2ce81031445430', datetime.datetime(2026, 2, 14, 16, 10, 52, 493908), datetime.datetime(2026, 1, 15, 16, 10, 52, 497079), False)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 1779s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 1779s ago] ('{"last_login": "2026-01-15T16:10:52.500299", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 10, 52, 503347), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 1779s ago] (UUID('bb926d4c-4ebe-4ace-a98e-608f5bf55382'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 10, 52, 507200))
[2026-01-15 16:10:52] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:10:52] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:10:52] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:10:52] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:10:52] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 859.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] [cached since 859.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:10:52] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:10:52] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:11:03] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] [cached since 870.3s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:11:03] INFO [user_controller] 开始用户登出
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] [cached since 859.1s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] [cached since 1791s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] [cached since 1791s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:11:03.649424", "last_activity": "2026-01-15T16:11:03.649424"}', datetime.datetime(2026, 1, 15, 16, 11, 3, 654083), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] [cached since 1790s ago] (UUID('095c51c3-3425-428b-b152-aa74b3fb16ed'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 11, 3, 658084))
[2026-01-15 16:11:03] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:11:03] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:11:03] INFO [user_controller] 用户登出成功
[2026-01-15 16:11:03] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:11:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:04] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 1912s ago] ('pyan83426@163.com',)
[2026-01-15 16:13:04] INFO [auth] Password verification successful
[2026-01-15 16:13:04] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:13:04.830760+00:00
[2026-01-15 16:13:04] INFO [auth] Created refresh token: eAf6BgLK...
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 1912s ago] (UUID('3a38156c-684f-47e9-8e3c-ec4bf29c964c'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'a35ee29cacf180ead949013e2e712bca6d37abb8569503d0bef4f1ce1a018d47', datetime.datetime(2026, 2, 14, 16, 13, 4, 831782), datetime.datetime(2026, 1, 15, 16, 13, 4, 832803), False)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 1912s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 1912s ago] ('{"last_login": "2026-01-15T16:13:04.835435", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 13, 4, 838627), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 1912s ago] (UUID('b8efcc88-2c45-4006-ab7f-ab1a86bde46c'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 13, 4, 841716))
[2026-01-15 16:13:04] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:04] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:13:04] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:13:04] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:04] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 991.5s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] [cached since 991.5s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:04] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:13:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:11] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] [cached since 998.4s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:11] INFO [user_controller] 开始用户登出
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] [cached since 987.2s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] [cached since 1919s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] [cached since 1919s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:13:11.750379", "last_activity": "2026-01-15T16:13:11.750379"}', datetime.datetime(2026, 1, 15, 16, 13, 11, 753115), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] [cached since 1919s ago] (UUID('967a84b9-b08d-4ec0-b397-b9e927915281'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 13, 11, 757006))
[2026-01-15 16:13:11] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:11] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:11] INFO [user_controller] 用户登出成功
[2026-01-15 16:13:11] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:13:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:49] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1956s ago] ('pyan83426@163.com',)
[2026-01-15 16:13:49] INFO [auth] Password verification successful
[2026-01-15 16:13:49] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:13:49.468162+00:00
[2026-01-15 16:13:49] INFO [auth] Created refresh token: WjNCwf1W...
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1956s ago] (UUID('bc3e6d8e-ca11-43e7-ba5f-5c4923f25870'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '68c217ae87dcbc184d2a8cfd59c28ab8f39ad8c3d8f79986aa01602b8edb4cf2', datetime.datetime(2026, 2, 14, 16, 13, 49, 469167), datetime.datetime(2026, 1, 15, 16, 13, 49, 470167), False)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1956s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1956s ago] ('{"last_login": "2026-01-15T16:13:49.473294", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 13, 49, 476321), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1956s ago] (UUID('d6d64f9e-39d8-4061-9a58-fb286f1dbfbc'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 13, 49, 481635))
[2026-01-15 16:13:49] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:49] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:13:49] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:13:49] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:49] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1036s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] [cached since 1036s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:49] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:13:49] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:59] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] [cached since 1046s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:13:59] INFO [user_controller] 开始用户登出
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] [cached since 1035s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] [cached since 1966s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] [cached since 1966s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:13:59.494485", "last_activity": "2026-01-15T16:13:59.494485"}', datetime.datetime(2026, 1, 15, 16, 13, 59, 497906), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] [cached since 1966s ago] (UUID('23c6a357-844a-4a94-af94-4819a555f0e5'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 13, 59, 501318))
[2026-01-15 16:13:59] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:59] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:13:59] INFO [user_controller] 用户登出成功
[2026-01-15 16:13:59] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:13:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:15:17] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 16:15:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:15:17] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 16:15:17] INFO [sqlalchemy.engine.Engine] [cached since 2045s ago] ('pyan83426@163.com',)
[2026-01-15 16:15:18] INFO [auth] Password verification successful
[2026-01-15 16:15:18] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 08:15:18.056627+00:00
[2026-01-15 16:15:18] INFO [auth] Created refresh token: Vc6Dn-ct...
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 2045s ago] (UUID('001edef5-4d79-4787-aa7e-06bea49d1713'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '33696647b9f08af6c7b3fb4e01d8144cc3b598e219c5808f0e40262630ed46b4', datetime.datetime(2026, 2, 14, 16, 15, 18, 56627), datetime.datetime(2026, 1, 15, 16, 15, 18, 58823), False)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 2045s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 2045s ago] ('{"last_login": "2026-01-15T16:15:18.061454", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 16, 15, 18, 65557), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 2045s ago] (UUID('4604b14b-735a-422c-8c11-a645f45cfc82'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 15, 18, 69679))
[2026-01-15 16:15:18] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:15:18] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 16:15:18] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 16:15:18] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:15:18] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 1125s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] [cached since 1125s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:15:18] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 16:15:18] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:15:21] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] [cached since 1129s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 16:15:21] INFO [user_controller] 开始用户登出
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] [cached since 1117s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] [cached since 2049s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] [cached since 2049s ago] ('{"status": "offline", "logout_time": "2026-01-15T16:15:21.987965", "last_activity": "2026-01-15T16:15:21.987965"}', datetime.datetime(2026, 1, 15, 16, 15, 21, 991030), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 16:15:21] INFO [sqlalchemy.engine.Engine] [cached since 2049s ago] (UUID('f24b2f21-0bce-4d61-b432-6ef486daeac5'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 16, 15, 21, 994112))
[2026-01-15 16:15:21] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:15:21] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 16:15:21] INFO [user_controller] 用户登出成功
[2026-01-15 16:15:21] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 16:15:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:24:15] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 6183s ago] ('pyan83426@163.com',)
[2026-01-15 17:24:16] INFO [auth] Password verification successful
[2026-01-15 17:24:16] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:24:16.406099+00:00
[2026-01-15 17:24:16] INFO [auth] Created refresh token: 9BM0QXsW...
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 6183s ago] (UUID('1ee80ed5-a5f8-45ea-b52d-c4cb0a627acf'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '936a37d4aa1b7cb27171309da1e03466c5e5f9a57a13ad0e8340f9590397817e', datetime.datetime(2026, 2, 14, 17, 24, 16, 408181), datetime.datetime(2026, 1, 15, 17, 24, 16, 410079), False)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 6183s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 6183s ago] ('{"last_login": "2026-01-15T17:24:16.428376", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 24, 16, 434131), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 6183s ago] (UUID('4c14f520-7b9e-42d5-84ac-422838abb141'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 24, 16, 440219))
[2026-01-15 17:24:16] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:24:16] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:24:16] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:24:16] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:24:16] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 5263s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] [cached since 5263s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:24:16] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:24:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:27:36] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] [cached since 5464s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:27:36] INFO [user_controller] 开始用户登出
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] [cached since 5452s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] [cached since 6384s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] [cached since 6384s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:27:36.885177", "last_activity": "2026-01-15T17:27:36.885177"}', datetime.datetime(2026, 1, 15, 17, 27, 36, 888176), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] [cached since 6384s ago] (UUID('e4813434-01d5-4132-8f5f-8da1f4e5af3a'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 27, 36, 893954))
[2026-01-15 17:27:36] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:27:36] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:27:36] INFO [user_controller] 用户登出成功
[2026-01-15 17:27:36] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:27:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:27:44] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 6391s ago] ('pyan83426@163.com',)
[2026-01-15 17:27:44] INFO [auth] Password verification successful
[2026-01-15 17:27:44] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:27:44.372081+00:00
[2026-01-15 17:27:44] INFO [auth] Created refresh token: Tcj0CcqW...
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 6391s ago] (UUID('f4a32020-6161-49e9-8ded-3fe6bd9263fe'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '7ce91431724dd47aaa036a02f375f721289125630f13385303901a81e5066593', datetime.datetime(2026, 2, 14, 17, 27, 44, 373285), datetime.datetime(2026, 1, 15, 17, 27, 44, 375330), False)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 6391s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 6391s ago] ('{"last_login": "2026-01-15T17:27:44.378895", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 27, 44, 383581), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 6391s ago] (UUID('a22ac66d-d8ee-4c23-bc05-e3e4d3ca2f1e'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 27, 44, 387973))
[2026-01-15 17:27:44] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:27:44] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:27:44] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:27:44] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:27:44] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 5471s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] [cached since 5471s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:27:44] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:27:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:29:58] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] [cached since 5605s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:29:58] INFO [user_controller] 开始用户登出
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] [cached since 5594s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] [cached since 6525s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] [cached since 6525s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:29:58.314353", "last_activity": "2026-01-15T17:29:58.314353"}', datetime.datetime(2026, 1, 15, 17, 29, 58, 317974), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] [cached since 6525s ago] (UUID('49876dcc-4249-49c1-b0dc-6c3f95fc5308'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 29, 58, 321325))
[2026-01-15 17:29:58] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:29:58] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:29:58] INFO [user_controller] 用户登出成功
[2026-01-15 17:29:58] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:29:58] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:30:03] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 6530s ago] ('pyan83426@163.com',)
[2026-01-15 17:30:03] INFO [auth] Password verification successful
[2026-01-15 17:30:03] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:30:03.421070+00:00
[2026-01-15 17:30:03] INFO [auth] Created refresh token: KHXHjaU2...
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 6530s ago] (UUID('e6db09fe-6d32-4d7a-af9f-f1beb3230823'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '0b10beb17aa95d2be40acedec226c2e76d58056ff080370c35744c929f7d5172', datetime.datetime(2026, 2, 14, 17, 30, 3, 422381), datetime.datetime(2026, 1, 15, 17, 30, 3, 423571), False)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 6530s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 6530s ago] ('{"last_login": "2026-01-15T17:30:03.425602", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 30, 3, 429474), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 6530s ago] (UUID('8ec6baf9-f122-4e83-8205-096fdcf0c866'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 30, 3, 433981))
[2026-01-15 17:30:03] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:30:03] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:30:03] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:30:03] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:30:03] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 5610s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] [cached since 5610s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:30:03] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:30:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:30:06] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] [cached since 5613s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:30:06] INFO [user_controller] 开始用户登出
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] [cached since 5602s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] [cached since 6534s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] [cached since 6534s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:30:06.722065", "last_activity": "2026-01-15T17:30:06.722065"}', datetime.datetime(2026, 1, 15, 17, 30, 6, 726498), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] [cached since 6534s ago] (UUID('54f38f71-a35b-4eef-bbe2-9e8634ed548f'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 30, 6, 729549))
[2026-01-15 17:30:06] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:30:06] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:30:06] INFO [user_controller] 用户登出成功
[2026-01-15 17:30:06] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:30:06] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:34:16] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 6783s ago] ('pyan83426@163.com',)
[2026-01-15 17:34:16] INFO [auth] Password verification successful
[2026-01-15 17:34:16] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:34:16.440761+00:00
[2026-01-15 17:34:16] INFO [auth] Created refresh token: PxtZsaeT...
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 6783s ago] (UUID('efb36f95-df2a-4a35-a399-055aae5266d3'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'e9490fee6318431bb2355c0bb9e448b9cc1e9241c83422ed0d87930e7a8f7b6a', datetime.datetime(2026, 2, 14, 17, 34, 16, 441760), datetime.datetime(2026, 1, 15, 17, 34, 16, 442558), False)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 6783s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 6783s ago] ('{"last_login": "2026-01-15T17:34:16.458818", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 34, 16, 461821), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 6783s ago] (UUID('ffa2990d-7600-4d60-85a5-d16162261aa8'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 34, 16, 466531))
[2026-01-15 17:34:16] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:34:16] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:34:16] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:34:16] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:34:16] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 5863s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] [cached since 5863s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:34:16] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:34:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:35:53] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] [cached since 5960s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:35:53] INFO [user_controller] 开始用户登出
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] [cached since 5949s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] [cached since 6880s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] [cached since 6880s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:35:53.527616", "last_activity": "2026-01-15T17:35:53.527616"}', datetime.datetime(2026, 1, 15, 17, 35, 53, 529622), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] [cached since 6880s ago] (UUID('887f6b70-0189-4f56-8225-36e28a021e58'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 35, 53, 535771))
[2026-01-15 17:35:53] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:35:53] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:35:53] INFO [user_controller] 用户登出成功
[2026-01-15 17:35:53] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:35:53] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:35:58] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] [cached since 6886s ago] ('pyan83426@163.com',)
[2026-01-15 17:35:58] INFO [auth] Password verification successful
[2026-01-15 17:35:58] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:35:58.826792+00:00
[2026-01-15 17:35:58] INFO [auth] Created refresh token: Y6JrOyN7...
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] [cached since 6886s ago] (UUID('090f498c-a98a-4f12-8de4-bdf73016f932'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'b48de9109c5db3f62cefc416ce2f9f79f9916954f937a04b2351e68bd138a7f8', datetime.datetime(2026, 2, 14, 17, 35, 58, 827812), datetime.datetime(2026, 1, 15, 17, 35, 58, 828833), False)
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] [cached since 6886s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] [cached since 6886s ago] ('{"last_login": "2026-01-15T17:35:58.831584", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 35, 58, 835666), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] [cached since 6886s ago] (UUID('beb458b6-7bed-46c1-81c1-bde6c4127efd'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 35, 58, 840859))
[2026-01-15 17:35:58] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:35:58] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:35:58] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:35:58] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:35:58] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:35:59] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] [cached since 5966s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] [cached since 5966s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:35:59] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:35:59] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:36:01] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] [cached since 5968s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:36:01] INFO [user_controller] 开始用户登出
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] [cached since 5957s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] [cached since 6889s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] [cached since 6888s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:36:01.647910", "last_activity": "2026-01-15T17:36:01.647910"}', datetime.datetime(2026, 1, 15, 17, 36, 1, 651700), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] [cached since 6888s ago] (UUID('aae9ed02-d163-4d5c-be94-ab81788e11fe'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 36, 1, 654754))
[2026-01-15 17:36:01] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:36:01] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:36:01] INFO [user_controller] 用户登出成功
[2026-01-15 17:36:01] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:36:01] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:36:18] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] [cached since 6906s ago] ('pyan83426@163.com',)
[2026-01-15 17:36:18] INFO [auth] Password verification successful
[2026-01-15 17:36:18] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:36:18.875078+00:00
[2026-01-15 17:36:18] INFO [auth] Created refresh token: 3PzPTJRD...
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] [cached since 6906s ago] (UUID('1375c610-9809-4c1a-ab5b-9d1052f5ad13'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '647ab04bc5f580fe58c525f0de2cf71a396dd43d9a303bf59aae1b78ae4b113c', datetime.datetime(2026, 2, 14, 17, 36, 18, 876108), datetime.datetime(2026, 1, 15, 17, 36, 18, 877132), False)
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] [cached since 6906s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] [cached since 6906s ago] ('{"last_login": "2026-01-15T17:36:18.880151", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 36, 18, 883251), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] [cached since 6906s ago] (UUID('1dc59426-e198-4a0b-b6e2-2f034e51b470'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 36, 18, 885293))
[2026-01-15 17:36:18] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:36:18] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:36:18] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:36:18] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:36:18] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:36:19] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] [cached since 5986s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] [cached since 5986s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:36:19] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:36:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:05] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] [cached since 6212s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:05] INFO [user_controller] 开始用户登出
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] [cached since 6201s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] [cached since 7133s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] [cached since 7133s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:40:05.834150", "last_activity": "2026-01-15T17:40:05.834150"}', datetime.datetime(2026, 1, 15, 17, 40, 5, 837161), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] [cached since 7133s ago] (UUID('76429be5-a33c-4e9f-9700-0029338db6e4'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 40, 5, 842247))
[2026-01-15 17:40:05] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:05] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:05] INFO [user_controller] 用户登出成功
[2026-01-15 17:40:05] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:40:05] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:16] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 7144s ago] ('pyan83426@163.com',)
[2026-01-15 17:40:16] INFO [auth] Password verification successful
[2026-01-15 17:40:16] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:40:16.658774+00:00
[2026-01-15 17:40:16] INFO [auth] Created refresh token: RYMzUDww...
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 7144s ago] (UUID('fc319455-db21-4df2-8da7-bdf9519a710d'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'dd269a9f6c1188144f8a45cf1f46864e835e50edbbd03e399bcb1c934bcc9e61', datetime.datetime(2026, 2, 14, 17, 40, 16, 659247), datetime.datetime(2026, 1, 15, 17, 40, 16, 659247), False)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 7144s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 7144s ago] ('{"last_login": "2026-01-15T17:40:16.659247", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 40, 16, 668057), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 7144s ago] (UUID('37353397-0cb4-46a1-8960-ec38be8b392b'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 40, 16, 672291))
[2026-01-15 17:40:16] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:16] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:40:16] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:40:16] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:16] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] [cached since 6224s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:17] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:40:17] INFO [sqlalchemy.engine.Engine] [cached since 6224s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:17] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:40:17] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:19] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] [cached since 6227s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:40:19] INFO [user_controller] 开始用户登出
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] [cached since 6215s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] [cached since 7147s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] [cached since 7147s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:40:19.928698", "last_activity": "2026-01-15T17:40:19.928698"}', datetime.datetime(2026, 1, 15, 17, 40, 19, 928698), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] [cached since 7147s ago] (UUID('b0ec1dbc-a8b4-41d8-8d3d-6462be7ea0c4'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 40, 19, 937404))
[2026-01-15 17:40:19] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:19] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:40:19] INFO [user_controller] 用户登出成功
[2026-01-15 17:40:19] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:40:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:09] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 7196s ago] ('pyan83426@163.com',)
[2026-01-15 17:41:09] INFO [auth] Password verification successful
[2026-01-15 17:41:09] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:41:09.465137+00:00
[2026-01-15 17:41:09] INFO [auth] Created refresh token: jIYw3b3H...
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 7196s ago] (UUID('6930d3cd-fe81-4e75-a0e6-4efa586c733b'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '2a0cfaaf1c6685aa5234aeac379de7e26e8fb2b04cf5658a867f5c18d183f649', datetime.datetime(2026, 2, 14, 17, 41, 9, 466141), datetime.datetime(2026, 1, 15, 17, 41, 9, 467146), False)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 7196s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 7196s ago] ('{"last_login": "2026-01-15T17:41:09.470187", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 41, 9, 474828), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 7196s ago] (UUID('365b5e78-fd40-4a19-b330-fdbd9ec17a41'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 9, 478867))
[2026-01-15 17:41:09] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:09] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:41:09] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:41:09] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:09] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 6276s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] [cached since 6276s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:09] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:41:09] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:11] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] [cached since 6278s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:11] INFO [user_controller] 开始用户登出
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] [cached since 6267s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] [cached since 7198s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] [cached since 7198s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:41:11.384246", "last_activity": "2026-01-15T17:41:11.384246"}', datetime.datetime(2026, 1, 15, 17, 41, 11, 389719), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] [cached since 7198s ago] (UUID('de169aa4-dd5c-489f-8a8d-4164eabec5ec'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 11, 395734))
[2026-01-15 17:41:11] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:11] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:11] INFO [user_controller] 用户登出成功
[2026-01-15 17:41:11] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:41:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:23] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 7210s ago] ('pyan83426@163.com',)
[2026-01-15 17:41:23] INFO [auth] Password verification successful
[2026-01-15 17:41:23] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:41:23.446106+00:00
[2026-01-15 17:41:23] INFO [auth] Created refresh token: KJTjRUxC...
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 7210s ago] (UUID('34398a3a-8fcf-4a63-905f-2b2a9256fd76'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '0d70e38491a92803e9fb12cf2825f3cc39ae3e11798b02276fb010faa04e0b79', datetime.datetime(2026, 2, 14, 17, 41, 23, 447127), datetime.datetime(2026, 1, 15, 17, 41, 23, 448146), False)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 7210s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 7210s ago] ('{"last_login": "2026-01-15T17:41:23.451195", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 41, 23, 454567), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 7210s ago] (UUID('39dd4517-efe8-415c-a5e6-298ab86e67f7'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 23, 458725))
[2026-01-15 17:41:23] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:23] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:41:23] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:41:23] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:23] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 6290s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] [cached since 6290s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:23] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:41:23] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:25] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] [cached since 6292s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:25] INFO [user_controller] 开始用户登出
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] [cached since 6281s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] [cached since 7212s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] [cached since 7212s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:41:25.369824", "last_activity": "2026-01-15T17:41:25.369824"}', datetime.datetime(2026, 1, 15, 17, 41, 25, 372645), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] [cached since 7212s ago] (UUID('f743c904-84f4-440c-bda1-90479827a833'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 25, 375733))
[2026-01-15 17:41:25] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:25] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:25] INFO [user_controller] 用户登出成功
[2026-01-15 17:41:25] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:41:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:47] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:41:47] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:47] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:41:47] INFO [sqlalchemy.engine.Engine] [cached since 7235s ago] ('pyan83426@163.com',)
[2026-01-15 17:41:48] INFO [auth] Password verification successful
[2026-01-15 17:41:48] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:41:48.208137+00:00
[2026-01-15 17:41:48] INFO [auth] Created refresh token: yidgapB9...
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 7235s ago] (UUID('21d2b706-da01-4144-ad5b-3a5d3f494da9'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '9396673ed185838e0fa7de015e960f926b74dbbf83783617b559f4406f03a511', datetime.datetime(2026, 2, 14, 17, 41, 48, 209159), datetime.datetime(2026, 1, 15, 17, 41, 48, 209890), False)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 7235s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 7235s ago] ('{"last_login": "2026-01-15T17:41:48.213654", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 41, 48, 216583), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 7235s ago] (UUID('25bd13d7-68aa-408f-9b88-c59652943d27'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 48, 220696))
[2026-01-15 17:41:48] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:48] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:41:48] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:41:48] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:48] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 6315s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] [cached since 6315s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:48] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:41:48] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:50] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] [cached since 6317s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:41:50] INFO [user_controller] 开始用户登出
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] [cached since 6306s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] [cached since 7237s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] [cached since 7237s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:41:50.247577", "last_activity": "2026-01-15T17:41:50.247577"}', datetime.datetime(2026, 1, 15, 17, 41, 50, 250587), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] [cached since 7237s ago] (UUID('91d46358-2043-4592-ac07-4ea0452c1116'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 41, 50, 254577))
[2026-01-15 17:41:50] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:50] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:41:50] INFO [user_controller] 用户登出成功
[2026-01-15 17:41:50] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:41:50] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:14] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:45:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:14] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:45:14] INFO [sqlalchemy.engine.Engine] [cached since 7442s ago] ('pyan83426@163.com',)
[2026-01-15 17:45:15] INFO [auth] Password verification successful
[2026-01-15 17:45:15] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:45:15.116198+00:00
[2026-01-15 17:45:15] INFO [auth] Created refresh token: 7ipgbJiD...
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 7442s ago] (UUID('d0302bc6-5f4e-4ae3-9935-6666ca50bddc'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'a8afcd4ae6dd60465f172b148386cdd8955062b3cc20deb32a837dfad56a9347', datetime.datetime(2026, 2, 14, 17, 45, 15, 116198), datetime.datetime(2026, 1, 15, 17, 45, 15, 116198), False)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 7442s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 7442s ago] ('{"last_login": "2026-01-15T17:45:15.122838", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 45, 15, 126089), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 7442s ago] (UUID('9d183531-7150-41f6-8034-8a6147013f4c'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 45, 15, 131110))
[2026-01-15 17:45:15] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:15] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:45:15] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:45:15] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:15] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 6522s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] [cached since 6522s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:15] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:45:15] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:17] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] [cached since 6524s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:17] INFO [user_controller] 开始用户登出
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] [cached since 6513s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] [cached since 7444s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] [cached since 7444s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:45:17.324579", "last_activity": "2026-01-15T17:45:17.324579"}', datetime.datetime(2026, 1, 15, 17, 45, 17, 328043), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] [cached since 7444s ago] (UUID('bb07bf76-6ba0-4fdf-9c98-309d4a13078f'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 45, 17, 330449))
[2026-01-15 17:45:17] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:17] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:17] INFO [user_controller] 用户登出成功
[2026-01-15 17:45:17] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:45:17] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:24] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:45:24] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:24] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:45:24] INFO [sqlalchemy.engine.Engine] [cached since 7452s ago] ('pyan83426@163.com',)
[2026-01-15 17:45:25] INFO [auth] Password verification successful
[2026-01-15 17:45:25] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:45:25.069254+00:00
[2026-01-15 17:45:25] INFO [auth] Created refresh token: LxNCUmcr...
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 7452s ago] (UUID('43e2d6fc-abc2-4a92-bb83-8d7afdc5b294'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'c126362393e73adfaed13380c731ad8105049940fe9c22ffe11ebf8ec5cf03dc', datetime.datetime(2026, 2, 14, 17, 45, 25, 69254), datetime.datetime(2026, 1, 15, 17, 45, 25, 71256), False)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 7452s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 7452s ago] ('{"last_login": "2026-01-15T17:45:25.073256", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 45, 25, 76257), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 7452s ago] (UUID('1b59c097-4944-4f26-918c-5c0c135631be'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 45, 25, 80724))
[2026-01-15 17:45:25] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:25] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:45:25] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:45:25] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:25] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 6532s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] [cached since 6532s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:25] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:45:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:26] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] [cached since 6534s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:45:26] INFO [user_controller] 开始用户登出
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] [cached since 6522s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] [cached since 7454s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] [cached since 7454s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:45:26.934232", "last_activity": "2026-01-15T17:45:26.934232"}', datetime.datetime(2026, 1, 15, 17, 45, 26, 937630), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] [cached since 7454s ago] (UUID('f86b03f8-50d4-4f16-bf0f-76815a3ed333'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 45, 26, 941607))
[2026-01-15 17:45:26] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:26] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:45:26] INFO [user_controller] 用户登出成功
[2026-01-15 17:45:26] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:45:26] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:47:54] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] [cached since 7602s ago] ('pyan83426@163.com',)
[2026-01-15 17:47:54] INFO [auth] Password verification successful
[2026-01-15 17:47:54] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:47:54.710852+00:00
[2026-01-15 17:47:54] INFO [auth] Created refresh token: TdDiPQOr...
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] [cached since 7602s ago] (UUID('42deb66c-b295-435b-8188-050c918b8837'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'cbea10d2c741a8f5bc5348123d163d64b35087cd673688ceb22a9191e5830718', datetime.datetime(2026, 2, 14, 17, 47, 54, 711908), datetime.datetime(2026, 1, 15, 17, 47, 54, 712918), False)
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] [cached since 7602s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] [cached since 7602s ago] ('{"last_login": "2026-01-15T17:47:54.715947", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 47, 54, 721580), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] [cached since 7602s ago] (UUID('e064706d-ef61-41f9-b4be-0dcca97d80ff'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 47, 54, 724608))
[2026-01-15 17:47:54] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:47:54] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:47:54] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:47:54] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:47:54] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:47:55] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] [cached since 6682s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] [cached since 6682s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:47:55] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:47:55] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:47:56] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] [cached since 6684s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:47:56] INFO [user_controller] 开始用户登出
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] [cached since 6672s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] [cached since 7604s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] [cached since 7604s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:47:56.942473", "last_activity": "2026-01-15T17:47:56.942473"}', datetime.datetime(2026, 1, 15, 17, 47, 56, 946660), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] [cached since 7604s ago] (UUID('e2005d39-8ef3-4b48-b8e4-41a332404146'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 47, 56, 949309))
[2026-01-15 17:47:56] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:47:56] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:47:56] INFO [user_controller] 用户登出成功
[2026-01-15 17:47:56] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:47:56] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:48:39] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] [cached since 7647s ago] ('pyan83426@163.com',)
[2026-01-15 17:48:39] INFO [auth] Password verification successful
[2026-01-15 17:48:39] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:48:39.896051+00:00
[2026-01-15 17:48:39] INFO [auth] Created refresh token: BwnIo9f4...
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] [cached since 7647s ago] (UUID('ee1165db-7c0c-4712-8197-00828efe9e94'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '65e6908dca04e508a010c8861a9a4868696e64d74f658c98a925b979631d9d48', datetime.datetime(2026, 2, 14, 17, 48, 39, 896051), datetime.datetime(2026, 1, 15, 17, 48, 39, 897075), False)
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] [cached since 7647s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] [cached since 7647s ago] ('{"last_login": "2026-01-15T17:48:39.899507", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 48, 39, 904201), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] [cached since 7647s ago] (UUID('bb3c9b0c-9d39-427d-b328-9f54f49e0ddc'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 48, 39, 907523))
[2026-01-15 17:48:39] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:48:39] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:48:39] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:48:39] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:48:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:48:40] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] [cached since 6727s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] [cached since 6727s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:48:40] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:48:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:48:41] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] [cached since 6729s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:48:41] INFO [user_controller] 开始用户登出
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] [cached since 6717s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] [cached since 7649s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] [cached since 7649s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:48:41.991875", "last_activity": "2026-01-15T17:48:41.991875"}', datetime.datetime(2026, 1, 15, 17, 48, 41, 994936), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:48:41] INFO [sqlalchemy.engine.Engine] [cached since 7649s ago] (UUID('d549bac0-6c23-44db-99b9-2140c03e535e'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 48, 41, 996742))
[2026-01-15 17:48:41] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:48:41] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:48:41] INFO [user_controller] 用户登出成功
[2026-01-15 17:48:42] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:48:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:56:30] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 8117s ago] ('pyan83426@163.com',)
[2026-01-15 17:56:30] INFO [auth] Password verification successful
[2026-01-15 17:56:30] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:56:30.463642+00:00
[2026-01-15 17:56:30] INFO [auth] Created refresh token: wYY7gXlE...
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 8117s ago] (UUID('81b67638-f607-49da-837f-8804d6462da1'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '00998c7635abd1a3d4f31472b4553ea12485714fb87a62ef3e69bbda31300bdb', datetime.datetime(2026, 2, 14, 17, 56, 30, 464642), datetime.datetime(2026, 1, 15, 17, 56, 30, 465644), False)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 8117s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 8117s ago] ('{"last_login": "2026-01-15T17:56:30.468819", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 56, 30, 472837), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 8117s ago] (UUID('98e01f89-9d75-401b-9d60-5d6bccc33c15'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 56, 30, 476352))
[2026-01-15 17:56:30] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:56:30] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:56:30] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:56:30] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:56:30] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 7197s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] [cached since 7197s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:56:30] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:56:30] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:57:10] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] [cached since 7237s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:57:10] INFO [user_controller] 开始用户登出
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] [cached since 7226s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] [cached since 8157s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] [cached since 8157s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:57:10.559037", "last_activity": "2026-01-15T17:57:10.559037"}', datetime.datetime(2026, 1, 15, 17, 57, 10, 563129), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] [cached since 8157s ago] (UUID('08011ab8-0019-4691-a12c-43e6a2d3bcb5'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 57, 10, 567486))
[2026-01-15 17:57:10] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:57:10] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:57:10] INFO [user_controller] 用户登出成功
[2026-01-15 17:57:10] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:57:10] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:57:18] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] [cached since 8166s ago] ('pyan83426@163.com',)
[2026-01-15 17:57:18] INFO [auth] Password verification successful
[2026-01-15 17:57:18] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 09:57:18.866781+00:00
[2026-01-15 17:57:18] INFO [auth] Created refresh token: _bCEI0f3...
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] [cached since 8166s ago] (UUID('e978ef10-4071-4adf-bfeb-bf99228f4118'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '9f7b5511bc982e158c0e933418c068b1a0bb49aec856381bac0996a843827347', datetime.datetime(2026, 2, 14, 17, 57, 18, 867785), datetime.datetime(2026, 1, 15, 17, 57, 18, 869888), False)
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] [cached since 8166s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] [cached since 8166s ago] ('{"last_login": "2026-01-15T17:57:18.872881", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 17, 57, 18, 874892), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] [cached since 8166s ago] (UUID('c0627e72-6094-4f41-8bc0-cf78f550b45a'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 57, 18, 879105))
[2026-01-15 17:57:18] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:57:18] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 17:57:18] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 17:57:18] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 17:57:18] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:57:19] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] [cached since 7246s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] [cached since 7246s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:57:19] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 17:57:19] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:58:16] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] [cached since 7304s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 17:58:16] INFO [user_controller] 开始用户登出
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] [cached since 7292s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] [cached since 8224s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] [cached since 8224s ago] ('{"status": "offline", "logout_time": "2026-01-15T17:58:16.938241", "last_activity": "2026-01-15T17:58:16.938241"}', datetime.datetime(2026, 1, 15, 17, 58, 16, 942309), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] [cached since 8224s ago] (UUID('3933b837-093c-4e62-a62d-227c5917d642'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 17, 58, 16, 946760))
[2026-01-15 17:58:16] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:58:16] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 17:58:16] INFO [user_controller] 用户登出成功
[2026-01-15 17:58:16] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 17:58:16] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:50:42] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:50:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:50:42] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:50:42] INFO [sqlalchemy.engine.Engine] [cached since 1.137e+04s ago] ('pyan83426@163.com',)
[2026-01-15 18:50:42] WARNING [auth] Password verification failed: invalid password
[2026-01-15 18:50:42] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 18:50:42] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 18:50:42] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 18:50:42] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:50:46] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:50:47] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:50:47] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:50:47] INFO [sqlalchemy.engine.Engine] [cached since 1.137e+04s ago] ('pyan83426@163.com',)
[2026-01-15 18:50:47] WARNING [auth] Password verification failed: invalid password
[2026-01-15 18:50:47] INFO [sqlalchemy.engine.Engine] ROLLBACK
[2026-01-15 18:50:47] ERROR [sql] ❌ 数据库事务失败: 用户名或密码错误
[2026-01-15 18:50:47] ERROR [app] API异常: 用户名或密码错误
[2026-01-15 18:50:47] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:51:07] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] [cached since 1.139e+04s ago] ('pyan83426@163.com',)
[2026-01-15 18:51:07] INFO [auth] Password verification successful
[2026-01-15 18:51:07] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 10:51:07.974239+00:00
[2026-01-15 18:51:07] INFO [auth] Created refresh token: Y_avSCe0...
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] [cached since 1.139e+04s ago] (UUID('3d08239e-9978-4de3-b1e8-04378b580784'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'd7160fc94250d6d6e7da36985a275e911914592864bd9ee0a23e75c5f763e8e1', datetime.datetime(2026, 2, 14, 18, 51, 7, 975593), datetime.datetime(2026, 1, 15, 18, 51, 7, 979289), False)
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] [cached since 1.139e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:51:07] INFO [sqlalchemy.engine.Engine] [cached since 1.139e+04s ago] ('{"last_login": "2026-01-15T18:51:07.985540", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 18, 51, 7, 993748), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] [cached since 1.139e+04s ago] (UUID('2e3b2ed3-db67-4f81-b25e-77352bf94057'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 51, 8, 201))
[2026-01-15 18:51:08] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:51:08] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 18:51:08] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 18:51:08] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:51:08] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] [cached since 1.047e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] [cached since 1.047e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:51:08] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 18:51:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:51:11] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] [cached since 1.048e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:51:11] INFO [user_controller] 开始用户登出
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] [cached since 1.047e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] [cached since 1.14e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] [cached since 1.14e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T18:51:11.511353", "last_activity": "2026-01-15T18:51:11.511353"}', datetime.datetime(2026, 1, 15, 18, 51, 11, 519173), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] [cached since 1.14e+04s ago] (UUID('61306669-f2ce-430d-ae8d-97e22355a890'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 51, 11, 524227))
[2026-01-15 18:51:11] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:51:11] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:51:11] INFO [user_controller] 用户登出成功
[2026-01-15 18:51:11] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 18:51:11] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:51:53] INFO [user_controller] 开始注册用户, IP: 127.0.0.1
[2026-01-15 18:52:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:52:16] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:52:18] INFO [sqlalchemy.engine.Engine] [cached since 1.147e+04s ago] ('2721644330@qq.com',)
[2026-01-15 18:52:27] INFO [sqlalchemy.engine.Engine] INSERT INTO users (id, username, email, password_hash, role, real_name, phone, gender, birth_date, constitution_type, avatar_url, is_active, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::DATE, $10::VARCHAR, $11::VARCHAR, $12::BOOLEAN, $13::TIMESTAMP WITHOUT TIME ZONE, $14::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:52:28] INFO [sqlalchemy.engine.Engine] [generated in 1.47325s] (UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), 'peng', '2721644330@qq.com', '$2b$12$AxTRv1iF7DqI6a.Y0esXpOam0FdZznnfAba5u.LWjA3QT7SgZs6wC', 'doctor', None, None, None, None, None, None, True, datetime.datetime(2026, 1, 15, 18, 52, 25, 763239), datetime.datetime(2026, 1, 15, 18, 52, 25, 766282))
[2026-01-15 18:52:30] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:52:31] INFO [sqlalchemy.engine.Engine] [generated in 1.61300s] (UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'),)
[2026-01-15 18:52:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:52:40] INFO [sqlalchemy.engine.Engine] [cached since 1.149e+04s ago] (UUID('7237dba5-3bb2-4016-a72b-07759e48c16b'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'register', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 52, 37, 677829))
[2026-01-15 18:52:42] INFO [UserService] 用户活动已记录: register, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:52:44] INFO [UserService] 用户注册成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 18:52:46] INFO [user_controller] 用户注册成功, IP: 127.0.0.1
[2026-01-15 18:52:49] INFO [app] 请求处理完成: POST /api/v1/users/register
[2026-01-15 18:52:49] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:53:14] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] ('2721644330@qq.com',)
[2026-01-15 18:53:14] INFO [auth] Password verification successful
[2026-01-15 18:53:14] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 10:53:14.738416+00:00
[2026-01-15 18:53:14] INFO [auth] Created refresh token: -qG_TmQO...
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] (UUID('cfec39b6-031e-4fde-b371-562a0bac78c2'), '58a7effc-3a94-4d9a-9073-387f6b77017a', 'e8e05e772f72acc89e092cb6a2f39e178b972c50ad6aefce7b4f3b7fa8359490', datetime.datetime(2026, 2, 14, 18, 53, 14, 752925), datetime.datetime(2026, 1, 15, 18, 53, 14, 754605), False)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] INSERT INTO user_states (app_name, user_id, state, update_time) VALUES ($1::VARCHAR, $2::UUID, $3::JSON, $4::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [generated in 0.00065s] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), '{"last_login": "2026-01-15T18:53:14.756609", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 18, 53, 14, 759611))
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] (UUID('39451705-8f4a-4da0-9a3c-764a62ea223b'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 53, 14, 767201))
[2026-01-15 18:53:14] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:53:14] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 18:53:14] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 18:53:14] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:53:14] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.06e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] [cached since 1.06e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 18:53:14] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 18:53:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:53:39] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] [cached since 1.063e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:53:39] INFO [user_controller] 开始用户登出
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] [cached since 1.062e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] [cached since 1.155e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] [cached since 1.155e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T18:53:39.843592", "last_activity": "2026-01-15T18:53:39.843592"}', datetime.datetime(2026, 1, 15, 18, 53, 39, 843592), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] [cached since 1.155e+04s ago] (UUID('1f0624b3-7027-4bd6-98be-826014ee39df'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 53, 39, 851191))
[2026-01-15 18:53:39] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:53:39] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 18:53:39] INFO [user_controller] 用户登出成功
[2026-01-15 18:53:39] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 18:53:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:43] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('pyan83426@163.com',)
[2026-01-15 18:59:43] INFO [auth] Password verification successful
[2026-01-15 18:59:43] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 10:59:43.444849+00:00
[2026-01-15 18:59:43] INFO [auth] Created refresh token: 3GdFzAOz...
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] (UUID('d3bdf65c-9f02-4131-84e1-1cae8f66a4bb'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'c6b1682cfad8610f6a5a5d6ffb170f687e8d7329089d65f2cc30fa7cd713f649', datetime.datetime(2026, 2, 14, 18, 59, 43, 446353), datetime.datetime(2026, 1, 15, 18, 59, 43, 446727), False)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('{"last_login": "2026-01-15T18:59:43.451954", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 18, 59, 43, 459274), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] (UUID('ee48c2e6-9cd5-4918-8741-9c47b24cb611'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 59, 43, 464458))
[2026-01-15 18:59:43] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:43] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 18:59:43] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 18:59:43] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:43] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:43] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 18:59:43] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:45] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:45] INFO [user_controller] 开始用户登出
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] [cached since 1.098e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T18:59:45.456961", "last_activity": "2026-01-15T18:59:45.456961"}', datetime.datetime(2026, 1, 15, 18, 59, 45, 460881), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] (UUID('79468cb4-8690-4d96-a637-48fb4d5003be'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 59, 45, 463999))
[2026-01-15 18:59:45] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:45] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:45] INFO [user_controller] 用户登出成功
[2026-01-15 18:59:45] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 18:59:45] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:47] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('pyan83426@163.com',)
[2026-01-15 18:59:47] INFO [auth] Password verification successful
[2026-01-15 18:59:47] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 10:59:47.575769+00:00
[2026-01-15 18:59:47] INFO [auth] Created refresh token: HG1oc_uP...
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] (UUID('17b39b83-187b-48ef-9bdf-897ea142ea48'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '33cac47b934d88297dc9c3b52537e86307fbced7604f497df852d3c3793939b6', datetime.datetime(2026, 2, 14, 18, 59, 47, 576776), datetime.datetime(2026, 1, 15, 18, 59, 47, 577856), False)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] ('{"last_login": "2026-01-15T18:59:47.580866", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 18, 59, 47, 584867), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.191e+04s ago] (UUID('8c16c108-2cd4-48d0-bca4-98be7c19c581'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 59, 47, 589053))
[2026-01-15 18:59:47] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:47] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 18:59:47] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 18:59:47] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:47] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:47] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 18:59:47] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:52] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] [cached since 1.1e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 18:59:52] INFO [user_controller] 开始用户登出
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] [cached since 1.099e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] [cached since 1.192e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] [cached since 1.192e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T18:59:52.044177", "last_activity": "2026-01-15T18:59:52.044177"}', datetime.datetime(2026, 1, 15, 18, 59, 52, 47546), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] [cached since 1.192e+04s ago] (UUID('a994e26e-b575-46b3-967c-3337fb02f1b4'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 18, 59, 52, 52215))
[2026-01-15 18:59:52] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:52] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 18:59:52] INFO [user_controller] 用户登出成功
[2026-01-15 18:59:52] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 18:59:52] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:04] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:00:04] INFO [auth] Password verification successful
[2026-01-15 19:00:04] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:00:04.422458+00:00
[2026-01-15 19:00:04] INFO [auth] Created refresh token: zpqfFsww...
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] (UUID('8d1f402e-bd5a-4317-9130-4283a4dbee58'), '58a7effc-3a94-4d9a-9073-387f6b77017a', '457edce1e53e865b35dc8f7b5d523d99b6e1584c30110e2c6cb4848eabef3817', datetime.datetime(2026, 2, 14, 19, 0, 4, 422458), datetime.datetime(2026, 1, 15, 19, 0, 4, 422458), False)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] ('{"last_login": "2026-01-15T19:00:04.427829", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 0, 4, 431888), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] (UUID('b2029bd6-89fc-4f62-8f78-f9592b688374'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 4, 434954))
[2026-01-15 19:00:04] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:04] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:00:04] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:00:04] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:04] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.101e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] [cached since 1.101e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:04] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:00:04] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:06] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] [cached since 1.101e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:06] INFO [user_controller] 开始用户登出
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] [cached since 1.1e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:00:06.453565", "last_activity": "2026-01-15T19:00:06.453565"}', datetime.datetime(2026, 1, 15, 19, 0, 6, 456382), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] [cached since 1.193e+04s ago] (UUID('06ef9cf5-2acb-4824-b778-96f61a6050b0'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 6, 460797))
[2026-01-15 19:00:06] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:06] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:06] INFO [user_controller] 用户登出成功
[2026-01-15 19:00:06] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:00:06] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:33] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:00:33] INFO [auth] Password verification successful
[2026-01-15 19:00:33] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:00:33.745263+00:00
[2026-01-15 19:00:33] INFO [auth] Created refresh token: 8T3AYAAh...
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] (UUID('3642a185-6173-4466-af9f-dd50899dbc3d'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '003ee5f1bb2b3264eb06ebae9c72c870125f3ef8db5924d539b203c450a5359f', datetime.datetime(2026, 2, 14, 19, 0, 33, 746285), datetime.datetime(2026, 1, 15, 19, 0, 33, 747303), False)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('{"last_login": "2026-01-15T19:00:33.750362", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 0, 33, 754368), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] (UUID('3802f546-359b-4e8c-b9fa-4d64c2bd919e'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 33, 757428))
[2026-01-15 19:00:33] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:33] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:00:33] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:00:33] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:33] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:33] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:00:33] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:35] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:35] INFO [user_controller] 开始用户登出
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] [cached since 1.103e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:00:35.397620", "last_activity": "2026-01-15T19:00:35.397620"}', datetime.datetime(2026, 1, 15, 19, 0, 35, 401479), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] (UUID('70a30cdd-5e78-4675-8466-5da07b079e42'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 35, 404865))
[2026-01-15 19:00:35] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:35] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:35] INFO [user_controller] 用户登出成功
[2026-01-15 19:00:35] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:00:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:37] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:00:37] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:37] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:00:37] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:00:38] INFO [auth] Password verification successful
[2026-01-15 19:00:38] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:00:38.119843+00:00
[2026-01-15 19:00:38] INFO [auth] Created refresh token: JSzNv5mx...
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] (UUID('145f2098-60ab-4dd2-a64d-c98239d43ede'), '58a7effc-3a94-4d9a-9073-387f6b77017a', 'dbfd6192f11d0c12c0f769b063cc7f7b1dcd64653ae5c0f15dde3ba5d3ee6937', datetime.datetime(2026, 2, 14, 19, 0, 38, 120863), datetime.datetime(2026, 1, 15, 19, 0, 38, 121888), False)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] ('{"last_login": "2026-01-15T19:00:38.125213", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 0, 38, 128312), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.196e+04s ago] (UUID('3d4fbb30-8430-4aae-bcb3-03ae59845a8b'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 38, 133414))
[2026-01-15 19:00:38] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:38] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:00:38] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:00:38] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:38] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:38] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:00:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:39] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] [cached since 1.105e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:39] INFO [user_controller] 开始用户登出
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:00:39.752494", "last_activity": "2026-01-15T19:00:39.752494"}', datetime.datetime(2026, 1, 15, 19, 0, 39, 757499), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] (UUID('d24d27a7-cf0c-4268-a436-a2f2b61118d8'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 39, 761210))
[2026-01-15 19:00:39] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:39] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:00:39] INFO [user_controller] 用户登出成功
[2026-01-15 19:00:39] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:00:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:43] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:00:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:43] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:00:43] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:00:44] INFO [auth] Password verification successful
[2026-01-15 19:00:44] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:00:44.195866+00:00
[2026-01-15 19:00:44] INFO [auth] Created refresh token: CZShb_oi...
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] (UUID('8bb50256-fc01-4a7f-a0cd-03ca1707bd21'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '8f2d510f75227426af9551fe2c46f9f6ee233661ee0b8b58fe092ef313d4f175', datetime.datetime(2026, 2, 14, 19, 0, 44, 196874), datetime.datetime(2026, 1, 15, 19, 0, 44, 197879), False)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('{"last_login": "2026-01-15T19:00:44.199900", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 0, 44, 203944), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] (UUID('3f006032-b222-4ac7-99af-b1a73b971b52'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 44, 207289))
[2026-01-15 19:00:44] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:44] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:00:44] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:00:44] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:44] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.105e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] [cached since 1.105e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:44] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:00:44] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:46] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] [cached since 1.105e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:00:46] INFO [user_controller] 开始用户登出
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] [cached since 1.104e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:00:46.066983", "last_activity": "2026-01-15T19:00:46.066983"}', datetime.datetime(2026, 1, 15, 19, 0, 46, 70022), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] [cached since 1.197e+04s ago] (UUID('92d7a1cf-7ab0-4134-90d8-18bd051b4c94'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 0, 46, 74605))
[2026-01-15 19:00:46] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:46] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:00:46] INFO [user_controller] 用户登出成功
[2026-01-15 19:00:46] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:00:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:36] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.202e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:01:36] INFO [auth] Password verification successful
[2026-01-15 19:01:36] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:01:36.468659+00:00
[2026-01-15 19:01:36] INFO [auth] Created refresh token: W1DVbpEu...
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.202e+04s ago] (UUID('e42c71c1-366e-46a8-9223-2bdea45ef6d6'), '58a7effc-3a94-4d9a-9073-387f6b77017a', '3cfa780029f82b0d297aa44fc56773ed809a9a1bd15c8947b0e52384dd95d446', datetime.datetime(2026, 2, 14, 19, 1, 36, 469663), datetime.datetime(2026, 1, 15, 19, 1, 36, 470821), False)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.202e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.202e+04s ago] ('{"last_login": "2026-01-15T19:01:36.473715", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 1, 36, 477756), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.202e+04s ago] (UUID('40f04ba1-06d8-492c-b89a-ba8cc7c36f4c'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 36, 480777))
[2026-01-15 19:01:36] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:36] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:01:36] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:01:36] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:36] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.11e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] [cached since 1.11e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:36] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:01:36] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:38] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] [cached since 1.11e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:38] INFO [user_controller] 开始用户登出
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] [cached since 1.109e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:01:38.307898", "last_activity": "2026-01-15T19:01:38.307898"}', datetime.datetime(2026, 1, 15, 19, 1, 38, 307898), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('1eb7f5f8-5b8c-4f7a-8381-ac15e6158b94'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 38, 314491))
[2026-01-15 19:01:38] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:38] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:38] INFO [user_controller] 用户登出成功
[2026-01-15 19:01:38] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:01:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:41] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:01:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:41] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:01:41] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:01:42] INFO [auth] Password verification successful
[2026-01-15 19:01:42] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:01:42.258605+00:00
[2026-01-15 19:01:42] INFO [auth] Created refresh token: vm7UPlaL...
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('b9982980-392c-458a-8e27-b00d1714d9ef'), '58a7effc-3a94-4d9a-9073-387f6b77017a', '24b25e84f0b306bbff8f777ff5394db73ab2b1f6b2d3fd81ed7f2371cf5ef096', datetime.datetime(2026, 2, 14, 19, 1, 42, 259267), datetime.datetime(2026, 1, 15, 19, 1, 42, 260278), False)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('{"last_login": "2026-01-15T19:01:42.262287", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 1, 42, 264295), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('954d34b3-156f-4ea2-a405-5cb2407e79bd'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 42, 268571))
[2026-01-15 19:01:42] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:42] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:01:42] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:01:42] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:42] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.111e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] [cached since 1.111e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:42] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:01:42] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:43] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] [cached since 1.111e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:43] INFO [user_controller] 开始用户登出
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] [cached since 1.11e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:01:43.905893", "last_activity": "2026-01-15T19:01:43.905893"}', datetime.datetime(2026, 1, 15, 19, 1, 43, 908945), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('d1fa6134-6306-4599-805f-6500414194fc'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 43, 912068))
[2026-01-15 19:01:43] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:43] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:01:43] INFO [user_controller] 用户登出成功
[2026-01-15 19:01:43] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:01:43] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:45] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:01:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:45] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:01:45] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:01:46] INFO [auth] Password verification successful
[2026-01-15 19:01:46] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:01:46.054990+00:00
[2026-01-15 19:01:46] INFO [auth] Created refresh token: 0_k5i-yw...
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('97d11cdb-e8bb-4c97-aee2-d0bb94f20940'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '06d64d5247355781e7419f53ece30e7ed2b7c33a55ca30c97b32c4f5963c5f73', datetime.datetime(2026, 2, 14, 19, 1, 46, 55999), datetime.datetime(2026, 1, 15, 19, 1, 46, 57589), False)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] ('{"last_login": "2026-01-15T19:01:46.059640", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 1, 46, 62722), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.203e+04s ago] (UUID('e6df4ff7-0d3c-435f-80d5-41a707ba7552'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 46, 66746))
[2026-01-15 19:01:46] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:46] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:01:46] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:01:46] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:46] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.111e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] [cached since 1.111e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:46] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:01:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:48] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] [cached since 1.112e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:48] INFO [user_controller] 开始用户登出
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] [cached since 1.11e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:01:48.532246", "last_activity": "2026-01-15T19:01:48.532246"}', datetime.datetime(2026, 1, 15, 19, 1, 48, 535752), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] (UUID('c8ece468-1834-4b71-9498-e87ea2d4084e'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 48, 537054))
[2026-01-15 19:01:48] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:48] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:48] INFO [user_controller] 用户登出成功
[2026-01-15 19:01:48] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:01:48] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:50] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:01:50] INFO [auth] Password verification successful
[2026-01-15 19:01:50] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:01:50.469404+00:00
[2026-01-15 19:01:50] INFO [auth] Created refresh token: 9_bYY0LZ...
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] (UUID('dce80792-1d14-4d77-8000-f180cc628dea'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '39302e1df8095094dbc6d0741054cfc709e60c3b0e81580a9e6c39e019798bbd', datetime.datetime(2026, 2, 14, 19, 1, 50, 470427), datetime.datetime(2026, 1, 15, 19, 1, 50, 472436), False)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] ('{"last_login": "2026-01-15T19:01:50.474263", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 1, 50, 478438), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.204e+04s ago] (UUID('3e30e123-6dc3-4725-bacb-872ff6fdde93'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 1, 50, 481577))
[2026-01-15 19:01:50] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:50] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:01:50] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:01:50] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:50] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.112e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] [cached since 1.112e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:01:50] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:01:50] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:04:02] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] [cached since 1.125e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:04:02] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:04:02] INFO [sqlalchemy.engine.Engine] [cached since 1.217e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:04:03] INFO [auth] Password verification successful
[2026-01-15 19:04:03] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:04:03.038748+00:00
[2026-01-15 19:04:03] INFO [auth] Created refresh token: BE9pXRBu...
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.217e+04s ago] (UUID('1dce4d8f-ade8-4dee-aeb0-c5feb8868156'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '5bd1cdbb1b9b714a9eba1805084818fd80a29a375c99a84b14cc9522a1155c32', datetime.datetime(2026, 2, 14, 19, 4, 3, 39764), datetime.datetime(2026, 1, 15, 19, 4, 3, 40799), False)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.217e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.217e+04s ago] ('{"last_login": "2026-01-15T19:04:03.043392", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 4, 3, 46703), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.217e+04s ago] (UUID('ffc4f5f3-7fd8-4e99-9c7e-5828df133325'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 4, 3, 50785))
[2026-01-15 19:04:03] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:04:03] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:04:03] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:04:03] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:04:03] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.125e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] [cached since 1.125e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:04:03] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:04:03] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:08:34] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:08:34] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:08:34] INFO [sqlalchemy.engine.Engine] [cached since 1.244e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:08:35] INFO [auth] Password verification successful
[2026-01-15 19:08:35] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:08:35.274079+00:00
[2026-01-15 19:08:35] INFO [auth] Created refresh token: PxHfCdzB...
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.244e+04s ago] (UUID('bc369bc5-f856-4d6a-a2fc-dd2c5fc8d59f'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '3734ad77ba8f1372f47399849c16b49707b1d674a182a2677f69b86bfae0616d', datetime.datetime(2026, 2, 14, 19, 8, 35, 274079), datetime.datetime(2026, 1, 15, 19, 8, 35, 275283), False)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.244e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.244e+04s ago] ('{"last_login": "2026-01-15T19:08:35.278346", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 8, 35, 281382), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.244e+04s ago] (UUID('c567db83-16d8-4f3a-b65a-c49d25a4d6ec'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 8, 35, 283424))
[2026-01-15 19:08:35] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:08:35] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:08:35] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:08:35] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:08:35] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] [cached since 1.152e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:08:35] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:08:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:21] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] [cached since 1.403e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:21] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:50:21] INFO [sqlalchemy.engine.Engine] [cached since 1.495e+04s ago] ('pyan83426@163.com',)
[2026-01-15 19:50:22] INFO [auth] Password verification successful
[2026-01-15 19:50:22] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 11:50:22.038321+00:00
[2026-01-15 19:50:22] INFO [auth] Created refresh token: cds-CmR8...
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.495e+04s ago] (UUID('7cf99c00-090e-47fa-b06a-74a3e26889a3'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '2cc1c7875c9eff658227498f354623f25b30653d9e15514dc3ca9d78af6a8ff6', datetime.datetime(2026, 2, 14, 19, 50, 22, 39330), datetime.datetime(2026, 1, 15, 19, 50, 22, 41856), False)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.495e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.495e+04s ago] ('{"last_login": "2026-01-15T19:50:22.058963", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 50, 22, 63994), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.495e+04s ago] (UUID('e0c8fbf0-a9da-4772-a8c8-958080438673'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 50, 22, 69974))
[2026-01-15 19:50:22] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:22] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 19:50:22] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:50:22] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:22] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.403e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] [cached since 1.403e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:50:22] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:50:22] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:41] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] [cached since 1.405e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:41] INFO [user_controller] 开始用户登出
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] [cached since 1.404e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T19:50:41.067346", "last_activity": "2026-01-15T19:50:41.067346"}', datetime.datetime(2026, 1, 15, 19, 50, 41, 70549), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] (UUID('68bc15b7-64db-486a-b9cb-34076bcbd042'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 50, 41, 74346))
[2026-01-15 19:50:41] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:41] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 19:50:41] INFO [user_controller] 用户登出成功
[2026-01-15 19:50:41] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 19:50:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:45] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:50:45] INFO [auth] Password verification successful
[2026-01-15 19:50:45] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:50:45.538871+00:00
[2026-01-15 19:50:45] INFO [auth] Created refresh token: 8RdFBdal...
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] (UUID('248d7e78-eb73-4138-957c-3fca573ac388'), '58a7effc-3a94-4d9a-9073-387f6b77017a', 'e090a51d37e2c56802cdf2ad9498487661b2d7cf7c7f1dc8c38f9d2bed571244', datetime.datetime(2026, 2, 14, 19, 50, 45, 540207), datetime.datetime(2026, 1, 15, 19, 50, 45, 541431), False)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] ('{"last_login": "2026-01-15T19:50:45.545900", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 50, 45, 550711), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.497e+04s ago] (UUID('ec1445d0-ff3f-4b1c-be86-82c50e21b350'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 50, 45, 554793))
[2026-01-15 19:50:45] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:50:45] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:50:45] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:50:45] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:45] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.405e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] [cached since 1.405e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:50:45] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:50:45] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:54:12] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] [cached since 1.426e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:54:12] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 19:54:12] INFO [sqlalchemy.engine.Engine] [cached since 1.518e+04s ago] ('2721644330@qq.com',)
[2026-01-15 19:54:13] INFO [auth] Password verification successful
[2026-01-15 19:54:13] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 11:54:13.331121+00:00
[2026-01-15 19:54:13] INFO [auth] Created refresh token: XMhh5O3f...
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.518e+04s ago] (UUID('4e653078-6bd6-415a-85a4-83cc8bda6c00'), '58a7effc-3a94-4d9a-9073-387f6b77017a', '45c6f4a3ad14fa491a5c06b0cd5469c0cfeed1d130ab5a21ccfcbcfb927e99ca', datetime.datetime(2026, 2, 14, 19, 54, 13, 332201), datetime.datetime(2026, 1, 15, 19, 54, 13, 333707), False)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.518e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.518e+04s ago] ('{"last_login": "2026-01-15T19:54:13.355818", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 19, 54, 13, 363366), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.518e+04s ago] (UUID('1df8cb31-4688-4bd4-a3cc-0c3565ce0316'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 19, 54, 13, 368992))
[2026-01-15 19:54:13] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:54:13] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 19:54:13] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 19:54:13] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:54:13] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.426e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] [cached since 1.426e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 19:54:13] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 19:54:13] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:25] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] [cached since 1.469e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:25] INFO [user_controller] 开始用户登出
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] [cached since 1.468e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] [cached since 1.561e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] [cached since 1.561e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T20:01:25.896489", "last_activity": "2026-01-15T20:01:25.896489"}', datetime.datetime(2026, 1, 15, 20, 1, 25, 901825), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] [cached since 1.561e+04s ago] (UUID('2a88e64e-b651-4172-aa16-6586278b7e1d'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 20, 1, 25, 907090))
[2026-01-15 20:01:25] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 20:01:25] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 20:01:25] INFO [user_controller] 用户登出成功
[2026-01-15 20:01:25] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 20:01:25] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:31] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] ('pyan83426@163.com',)
[2026-01-15 20:01:31] INFO [auth] Password verification successful
[2026-01-15 20:01:31] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 12:01:31.358732+00:00
[2026-01-15 20:01:31] INFO [auth] Created refresh token: 7sszMFwM...
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] (UUID('71a01d23-edc0-4c9d-97fd-6edcee0081c7'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', 'fad00ead0f33fc1ae8370aaf6147a2ace80d87dc917551fb93cb662ff40420bc', datetime.datetime(2026, 2, 14, 20, 1, 31, 360241), datetime.datetime(2026, 1, 15, 20, 1, 31, 361275), False)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] ('{"last_login": "2026-01-15T20:01:31.365923", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 20, 1, 31, 371984), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] (UUID('b54ff958-b33b-4d36-b7a2-cf025d0cf97e'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 20, 1, 31, 377235))
[2026-01-15 20:01:31] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 20:01:31] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 20:01:31] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 20:01:31] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:31] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.47e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] [cached since 1.47e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 20:01:31] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 20:01:31] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:37] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] [cached since 1.47e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 20:01:37] INFO [user_controller] 开始用户登出
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] [cached since 1.469e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T20:01:37.287286", "last_activity": "2026-01-15T20:01:37.287286"}', datetime.datetime(2026, 1, 15, 20, 1, 37, 290834), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] [cached since 1.562e+04s ago] (UUID('6d743121-b8e1-472d-835a-8dbcfa40222e'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 20, 1, 37, 296075))
[2026-01-15 20:01:37] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 20:01:37] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 20:01:37] INFO [user_controller] 用户登出成功
[2026-01-15 20:01:37] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 20:01:37] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:00:23] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 21:00:23] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:00:23] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 21:00:23] INFO [sqlalchemy.engine.Engine] [cached since 1.915e+04s ago] ('pyan83426@163.com',)
[2026-01-15 21:00:23] INFO [auth] Password verification successful
[2026-01-15 21:00:23] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 13:00:23.980411+00:00
[2026-01-15 21:00:23] INFO [auth] Created refresh token: jZqy5Ix3...
[2026-01-15 21:00:23] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 21:00:23] INFO [sqlalchemy.engine.Engine] [cached since 1.915e+04s ago] (UUID('5bbc3187-0d61-4e43-8755-f64572421360'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '0bea5eaea24c95998acf2c8b1a8714853cb5b00f6c3c4259966d60790a1c9fc6', datetime.datetime(2026, 2, 14, 21, 0, 23, 993375), datetime.datetime(2026, 1, 15, 21, 0, 23, 995976), False)
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] [cached since 1.915e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] [cached since 1.915e+04s ago] ('{"last_login": "2026-01-15T21:00:24.003275", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 21, 0, 24, 10340), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] [cached since 1.915e+04s ago] (UUID('d6df9616-edec-4de5-a27b-8a771882165f'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 0, 24, 16805))
[2026-01-15 21:00:24] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:00:24] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 21:00:24] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 21:00:24] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:00:24] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] [cached since 1.823e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] [cached since 1.823e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:00:24] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 21:00:24] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:01:08] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] [cached since 1.827e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:01:08] INFO [user_controller] 开始用户登出
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] [cached since 1.826e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] [cached since 1.919e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] [cached since 1.919e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T21:01:08.040270", "last_activity": "2026-01-15T21:01:08.040270"}', datetime.datetime(2026, 1, 15, 21, 1, 8, 44346), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] [cached since 1.919e+04s ago] (UUID('2744360e-4515-4e5e-9b27-48b97d0be9e2'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 1, 8, 49462))
[2026-01-15 21:01:08] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:01:08] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:01:08] INFO [user_controller] 用户登出成功
[2026-01-15 21:01:08] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 21:01:08] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:01:13] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 21:01:13] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:01:13] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 21:01:13] INFO [sqlalchemy.engine.Engine] [cached since 1.92e+04s ago] ('2721644330@qq.com',)
[2026-01-15 21:01:14] INFO [auth] Password verification successful
[2026-01-15 21:01:14] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 13:01:14.022555+00:00
[2026-01-15 21:01:14] INFO [auth] Created refresh token: E5e5OgIY...
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.92e+04s ago] (UUID('b0d448cd-9f80-48ff-8ba8-e97a0cf3baa4'), '58a7effc-3a94-4d9a-9073-387f6b77017a', 'c7450e0688b4d07113744e2a13e073cb0b386c8fd00385919484290fc496144d', datetime.datetime(2026, 2, 14, 21, 1, 14, 24062), datetime.datetime(2026, 1, 15, 21, 1, 14, 24062), False)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.92e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.92e+04s ago] ('{"last_login": "2026-01-15T21:01:14.031496", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 21, 1, 14, 35735), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.92e+04s ago] (UUID('09a6ecf6-89c3-44a6-9752-f2fb651241dd'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 1, 14, 41849))
[2026-01-15 21:01:14] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:01:14] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 21:01:14] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 21:01:14] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:01:14] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.828e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] [cached since 1.828e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:01:14] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 21:01:14] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:04:46] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] [cached since 1.849e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:04:46] INFO [user_controller] 开始用户登出
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] [cached since 1.848e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] [cached since 1.941e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] [cached since 1.941e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T21:04:46.430371", "last_activity": "2026-01-15T21:04:46.430371"}', datetime.datetime(2026, 1, 15, 21, 4, 46, 434421), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] [cached since 1.941e+04s ago] (UUID('07e69477-635a-4343-9b61-95ee34455c00'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 4, 46, 439785))
[2026-01-15 21:04:46] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:04:46] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:04:46] INFO [user_controller] 用户登出成功
[2026-01-15 21:04:46] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 21:04:46] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:07:34] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 21:07:34] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:07:34] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 21:07:34] INFO [sqlalchemy.engine.Engine] [cached since 1.958e+04s ago] ('2721644330@qq.com',)
[2026-01-15 21:07:35] INFO [auth] Password verification successful
[2026-01-15 21:07:35] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 13:07:35.318593+00:00
[2026-01-15 21:07:35] INFO [auth] Created refresh token: _uZXZzUJ...
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.958e+04s ago] (UUID('590677a6-ada1-4182-a5af-b19fac92c2c2'), '58a7effc-3a94-4d9a-9073-387f6b77017a', '856010897e3920ebb9e149ff4aec4a9b58a014d7967f6f3fabafa6d5c7a675ff', datetime.datetime(2026, 2, 14, 21, 7, 35, 318593), datetime.datetime(2026, 1, 15, 21, 7, 35, 319597), False)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.958e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.958e+04s ago] ('{"last_login": "2026-01-15T21:07:35.322652", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 21, 7, 35, 337775), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.958e+04s ago] (UUID('4dc1ed58-c12f-4005-ad89-e6b484b11d7a'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 7, 35, 341820))
[2026-01-15 21:07:35] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:07:35] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 21:07:35] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 21:07:35] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:07:35] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.866e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] [cached since 1.866e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:07:35] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 21:07:35] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:07:39] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] [cached since 1.867e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:07:39] INFO [user_controller] 开始用户登出
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] [cached since 1.866e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] [cached since 1.959e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] [cached since 1.959e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T21:07:39.654278", "last_activity": "2026-01-15T21:07:39.654278"}', datetime.datetime(2026, 1, 15, 21, 7, 39, 658808), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] [cached since 1.959e+04s ago] (UUID('b2f42a94-226e-45b8-98fd-17cf06d62324'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 7, 39, 663021))
[2026-01-15 21:07:39] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:07:39] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:07:39] INFO [user_controller] 用户登出成功
[2026-01-15 21:07:39] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 21:07:39] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:08:40] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.965e+04s ago] ('pyan83426@163.com',)
[2026-01-15 21:08:40] INFO [auth] Password verification successful
[2026-01-15 21:08:40] INFO [auth] Created access token for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b, expires at 2026-01-16 13:08:40.533807+00:00
[2026-01-15 21:08:40] INFO [auth] Created refresh token: u_nBbkLG...
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.965e+04s ago] (UUID('c94ffe55-6931-4c1f-8339-cecff5cebe73'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', '6042ea026d7782c65f9828bc2bd30509d377ad9a2371d375f3a869221cac9a36', datetime.datetime(2026, 2, 14, 21, 8, 40, 533807), datetime.datetime(2026, 1, 15, 21, 8, 40, 535328), False)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.965e+04s ago] ('Smart-TCM', UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.965e+04s ago] ('{"last_login": "2026-01-15T21:08:40.538638", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 21, 8, 40, 551669), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.965e+04s ago] (UUID('35250c02-3797-48fc-a1e8-6063d0d5d48f'), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 8, 40, 555385))
[2026-01-15 21:08:40] INFO [UserService] 用户活动已记录: login, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:08:40] INFO [UserService] 用户登录成功: pyan83426@163.com, IP: 127.0.0.1
[2026-01-15 21:08:40] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 21:08:40] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:08:40] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.873e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] [cached since 1.873e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:08:40] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 21:08:40] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:09:38] INFO [auth] Token verified successfully for user de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] [cached since 1.879e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:09:38] INFO [user_controller] 开始用户登出
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] [cached since 1.877e+04s ago] ('de37cb1c-e997-4916-b8ea-9763e1fa4d8b',)
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] ('Smart-TCM', 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b')
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T21:09:38.893947", "last_activity": "2026-01-15T21:09:38.893947"}', datetime.datetime(2026, 1, 15, 21, 9, 38, 899394), UUID('de37cb1c-e997-4916-b8ea-9763e1fa4d8b'))
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] (UUID('c4da1e71-b9af-4e9a-b16d-dbbc09069038'), 'de37cb1c-e997-4916-b8ea-9763e1fa4d8b', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 9, 38, 902589))
[2026-01-15 21:09:38] INFO [UserService] 用户活动已记录: logout, user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:09:38] INFO [UserService] 用户登出成功: user_id=de37cb1c-e997-4916-b8ea-9763e1fa4d8b
[2026-01-15 21:09:38] INFO [user_controller] 用户登出成功
[2026-01-15 21:09:38] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 21:09:38] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:09:41] INFO [user_controller] 开始用户登录, IP: 127.0.0.1
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] SELECT users.id, users.username, users.email, users.password_hash, users.role, users.real_name, users.phone, users.gender, users.birth_date, users.constitution_type, users.avatar_url, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] ('2721644330@qq.com',)
[2026-01-15 21:09:41] INFO [auth] Password verification successful
[2026-01-15 21:09:41] INFO [auth] Created access token for user 58a7effc-3a94-4d9a-9073-387f6b77017a, expires at 2026-01-16 13:09:41.794520+00:00
[2026-01-15 21:09:41] INFO [auth] Created refresh token: rvk-IfNF...
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] INSERT INTO refresh_tokens (id, user_id, token_hash, expires_at, created_at, is_revoked) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::TIMESTAMP WITHOUT TIME ZONE, $6::BOOLEAN)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] (UUID('708078bc-70d9-423e-9181-cee9755c6c2b'), '58a7effc-3a94-4d9a-9073-387f6b77017a', 'b2daaf969f40745fcc08b43023f7db23e9b6b21b82d812dcfc2ef310c3259e4c', datetime.datetime(2026, 2, 14, 21, 9, 41, 795520), datetime.datetime(2026, 1, 15, 21, 9, 41, 796524), False)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] ('Smart-TCM', UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] ('{"last_login": "2026-01-15T21:09:41.798592", "login_count": 1, "email_verified": true}', datetime.datetime(2026, 1, 15, 21, 9, 41, 803282), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.971e+04s ago] (UUID('df6aacd7-c6e8-47d4-80a0-878e5cd164ab'), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'), None, 'login', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 9, 41, 806718))
[2026-01-15 21:09:41] INFO [UserService] 用户活动已记录: login, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:09:41] INFO [UserService] 用户登录成功: 2721644330@qq.com, IP: 127.0.0.1
[2026-01-15 21:09:41] INFO [user_controller] 用户登录成功, IP: 127.0.0.1
[2026-01-15 21:09:41] INFO [app] 请求处理完成: POST /api/v1/users/login
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:09:41] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.879e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] SELECT users.id AS users_id, users.username AS users_username, users.email AS users_email, users.password_hash AS users_password_hash, users.role AS users_role, users.real_name AS users_real_name, users.phone AS users_phone, users.gender AS users_gender, users.birth_date AS users_birth_date, users.constitution_type AS users_constitution_type, users.avatar_url AS users_avatar_url, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] [cached since 1.879e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:09:41] INFO [app] 请求处理完成: GET /api/v1/users/me
[2026-01-15 21:09:41] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:10:01] INFO [auth] Token verified successfully for user 58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] SELECT users.role 
FROM users 
WHERE users.id = $1::UUID
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] [cached since 1.881e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:10:01] INFO [user_controller] 开始用户登出
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] BEGIN (implicit)
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] DELETE FROM refresh_tokens WHERE refresh_tokens.user_id = $1::UUID
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] [cached since 1.88e+04s ago] ('58a7effc-3a94-4d9a-9073-387f6b77017a',)
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] SELECT user_states.app_name, user_states.user_id, user_states.state, user_states.update_time 
FROM user_states 
WHERE user_states.app_name = $1::VARCHAR AND user_states.user_id = $2::UUID
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] [cached since 1.973e+04s ago] ('Smart-TCM', '58a7effc-3a94-4d9a-9073-387f6b77017a')
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] UPDATE user_states SET state=$1::JSON, update_time=$2::TIMESTAMP WITHOUT TIME ZONE WHERE user_states.user_id = $3::UUID
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] [cached since 1.973e+04s ago] ('{"status": "offline", "logout_time": "2026-01-15T21:10:01.823478", "last_activity": "2026-01-15T21:10:01.823478"}', datetime.datetime(2026, 1, 15, 21, 10, 1, 827073), UUID('58a7effc-3a94-4d9a-9073-387f6b77017a'))
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] INSERT INTO user_activities (id, user_id, session_id, activity_type, activity_data, ip_address, user_agent, resource, created_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::VARCHAR, $5::JSON, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::TIMESTAMP WITHOUT TIME ZONE)
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] [cached since 1.973e+04s ago] (UUID('e6625a1d-65ce-43c1-a893-3060f52ddc25'), '58a7effc-3a94-4d9a-9073-387f6b77017a', None, 'logout', '{}', '127.0.0.1', None, None, datetime.datetime(2026, 1, 15, 21, 10, 1, 833795))
[2026-01-15 21:10:01] INFO [UserService] 用户活动已记录: logout, user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:10:01] INFO [UserService] 用户登出成功: user_id=58a7effc-3a94-4d9a-9073-387f6b77017a
[2026-01-15 21:10:01] INFO [user_controller] 用户登出成功
[2026-01-15 21:10:01] INFO [app] 请求处理完成: POST /api/v1/users/logout
[2026-01-15 21:10:01] INFO [sqlalchemy.engine.Engine] COMMIT
[2026-01-15 21:24:56] WARNING [AuthDecorators] 未授权访问: get_me
[2026-01-15 21:24:56] ERROR [sql] ❌ 数据库事务失败: 401: 请先登录
[2026-01-15 21:24:56] INFO [app] 请求处理完成: GET /api/v1/users/me
